import{j as e,U as be,C as ye,X as He,P as pt,a as gt,A as ft,T as We,E as bt,S as yt,u as jt,Q as Nt,b as vt}from"./ui-BNKbNppi.js";import{a as wt,r as i,R as kt}from"./vendor-nf7bT_Uh.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();var xe={},Te=wt;xe.createRoot=Te.createRoot,xe.hydrateRoot=Te.hydrateRoot;/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Ie="popstate";function Ct(t={}){function s(n,r){let{pathname:l,search:o,hash:d}=n.location;return he("",{pathname:l,search:o,hash:d},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function a(n,r){return typeof r=="string"?r:G(r)}return Pt(s,a,null,t)}function P(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function L(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function St(){return Math.random().toString(36).substring(2,10)}function Ae(t,s){return{usr:t.state,key:t.key,idx:s}}function he(t,s,a=null,n){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof s=="string"?Q(s):s,state:a,key:s&&s.key||n||St()}}function G({pathname:t="/",search:s="",hash:a=""}){return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),a&&a!=="#"&&(t+=a.charAt(0)==="#"?a:"#"+a),t}function Q(t){let s={};if(t){let a=t.indexOf("#");a>=0&&(s.hash=t.substring(a),t=t.substring(0,a));let n=t.indexOf("?");n>=0&&(s.search=t.substring(n),t=t.substring(0,n)),t&&(s.pathname=t)}return s}function Pt(t,s,a,n={}){let{window:r=document.defaultView,v5Compat:l=!1}=n,o=r.history,d="POP",c=null,u=m();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function m(){return(o.state||{idx:null}).idx}function g(){d="POP";let j=m(),N=j==null?null:j-u;u=j,c&&c({action:d,location:b.location,delta:N})}function h(j,N){d="PUSH";let x=he(b.location,j,N);u=m()+1;let f=Ae(x,u),v=b.createHref(x);try{o.pushState(f,"",v)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;r.location.assign(v)}l&&c&&c({action:d,location:b.location,delta:1})}function p(j,N){d="REPLACE";let x=he(b.location,j,N);u=m();let f=Ae(x,u),v=b.createHref(x);o.replaceState(f,"",v),l&&c&&c({action:d,location:b.location,delta:0})}function y(j){return Et(j)}let b={get action(){return d},get location(){return t(r,o)},listen(j){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(Ie,g),c=j,()=>{r.removeEventListener(Ie,g),c=null}},createHref(j){return s(r,j)},createURL:y,encodeLocation(j){let N=y(j);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:h,replace:p,go(j){return o.go(j)}};return b}function Et(t,s=!1){let a="http://localhost";typeof window<"u"&&(a=window.location.origin!=="null"?window.location.origin:window.location.href),P(a,"No window.location.(origin|href) available to create URL");let n=typeof t=="string"?t:G(t);return n=n.replace(/ $/,"%20"),!s&&n.startsWith("//")&&(n=a+n),new URL(n,a)}function ze(t,s,a="/"){return Dt(t,s,a,!1)}function Dt(t,s,a,n){let r=typeof s=="string"?Q(s):s,l=M(r.pathname||"/",a);if(l==null)return null;let o=Qe(t);$t(o);let d=null;for(let c=0;d==null&&c<o.length;++c){let u=Bt(l);d=Mt(o[c],u,n)}return d}function Qe(t,s=[],a=[],n="",r=!1){let l=(o,d,c=r,u)=>{let m={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:d,route:o};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(n)&&c)return;P(m.relativePath.startsWith(n),`Absolute route path "${m.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(n.length)}let g=q([n,m.relativePath]),h=a.concat(m);o.children&&o.children.length>0&&(P(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),Qe(o.children,s,h,g,c)),!(o.path==null&&!o.index)&&s.push({path:g,score:Ut(g,o.index),routesMeta:h})};return t.forEach((o,d)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))l(o,d);else for(let u of Ve(o.path))l(o,d,!0,u)}),s}function Ve(t){let s=t.split("/");if(s.length===0)return[];let[a,...n]=s,r=a.endsWith("?"),l=a.replace(/\?$/,"");if(n.length===0)return r?[l,""]:[l];let o=Ve(n.join("/")),d=[];return d.push(...o.map(c=>c===""?l:[l,c].join("/"))),r&&d.push(...o),d.map(c=>t.startsWith("/")&&c===""?"/":c)}function $t(t){t.sort((s,a)=>s.score!==a.score?a.score-s.score:qt(s.routesMeta.map(n=>n.childrenIndex),a.routesMeta.map(n=>n.childrenIndex)))}var Rt=/^:[\w-]+$/,Lt=3,Tt=2,It=1,At=10,Ft=-2,Fe=t=>t==="*";function Ut(t,s){let a=t.split("/"),n=a.length;return a.some(Fe)&&(n+=Ft),s&&(n+=Tt),a.filter(r=>!Fe(r)).reduce((r,l)=>r+(Rt.test(l)?Lt:l===""?It:At),n)}function qt(t,s){return t.length===s.length&&t.slice(0,-1).every((n,r)=>n===s[r])?t[t.length-1]-s[s.length-1]:0}function Mt(t,s,a=!1){let{routesMeta:n}=t,r={},l="/",o=[];for(let d=0;d<n.length;++d){let c=n[d],u=d===n.length-1,m=l==="/"?s:s.slice(l.length)||"/",g=ae({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},m),h=c.route;if(!g&&u&&a&&!n[n.length-1].route.index&&(g=ae({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},m)),!g)return null;Object.assign(r,g.params),o.push({params:r,pathname:q([l,g.pathname]),pathnameBase:Qt(q([l,g.pathnameBase])),route:h}),g.pathnameBase!=="/"&&(l=q([l,g.pathnameBase]))}return o}function ae(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[a,n]=Ot(t.path,t.caseSensitive,t.end),r=s.match(a);if(!r)return null;let l=r[0],o=l.replace(/(.)\/+$/,"$1"),d=r.slice(1);return{params:n.reduce((u,{paramName:m,isOptional:g},h)=>{if(m==="*"){let y=d[h]||"";o=l.slice(0,l.length-y.length).replace(/(.)\/+$/,"$1")}const p=d[h];return g&&!p?u[m]=void 0:u[m]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:l,pathnameBase:o,pattern:t}}function Ot(t,s=!1,a=!0){L(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,d,c)=>(n.push({paramName:d,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(n.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,s?void 0:"i"),n]}function Bt(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return L(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${s}).`),t}}function M(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let a=s.endsWith("/")?s.length-1:s.length,n=t.charAt(a);return n&&n!=="/"?null:t.slice(a)||"/"}function Ht(t,s="/"){let{pathname:a,search:n="",hash:r=""}=typeof t=="string"?Q(t):t;return{pathname:a?a.startsWith("/")?a:Wt(a,s):s,search:Vt(n),hash:_t(r)}}function Wt(t,s){let a=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?a.length>1&&a.pop():r!=="."&&a.push(r)}),a.length>1?a.join("/"):"/"}function me(t,s,a,n){return`Cannot include a '${t}' character in a manually specified \`to.${s}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function zt(t){return t.filter((s,a)=>a===0||s.route.path&&s.route.path.length>0)}function je(t){let s=zt(t);return s.map((a,n)=>n===s.length-1?a.pathname:a.pathnameBase)}function Ne(t,s,a,n=!1){let r;typeof t=="string"?r=Q(t):(r={...t},P(!r.pathname||!r.pathname.includes("?"),me("?","pathname","search",r)),P(!r.pathname||!r.pathname.includes("#"),me("#","pathname","hash",r)),P(!r.search||!r.search.includes("#"),me("#","search","hash",r)));let l=t===""||r.pathname==="",o=l?"/":r.pathname,d;if(o==null)d=a;else{let g=s.length-1;if(!n&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),g-=1;r.pathname=h.join("/")}d=g>=0?s[g]:"/"}let c=Ht(r,d),u=o&&o!=="/"&&o.endsWith("/"),m=(l||o===".")&&a.endsWith("/");return!c.pathname.endsWith("/")&&(u||m)&&(c.pathname+="/"),c}var q=t=>t.join("/").replace(/\/\/+/g,"/"),Qt=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Vt=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,_t=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Jt(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var _e=["POST","PUT","PATCH","DELETE"];new Set(_e);var Kt=["GET",..._e];new Set(Kt);var V=i.createContext(null);V.displayName="DataRouter";var le=i.createContext(null);le.displayName="DataRouterState";i.createContext(!1);var Je=i.createContext({isTransitioning:!1});Je.displayName="ViewTransition";var Yt=i.createContext(new Map);Yt.displayName="Fetchers";var Gt=i.createContext(null);Gt.displayName="Await";var T=i.createContext(null);T.displayName="Navigation";var X=i.createContext(null);X.displayName="Location";var I=i.createContext({outlet:null,matches:[],isDataRoute:!1});I.displayName="Route";var ve=i.createContext(null);ve.displayName="RouteError";function Xt(t,{relative:s}={}){P(_(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:n}=i.useContext(T),{hash:r,pathname:l,search:o}=ee(t,{relative:s}),d=l;return a!=="/"&&(d=l==="/"?a:q([a,l])),n.createHref({pathname:d,search:o,hash:r})}function _(){return i.useContext(X)!=null}function O(){return P(_(),"useLocation() may be used only in the context of a <Router> component."),i.useContext(X).location}var Ke="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Ye(t){i.useContext(T).static||i.useLayoutEffect(t)}function Z(){let{isDataRoute:t}=i.useContext(I);return t?us():Zt()}function Zt(){P(_(),"useNavigate() may be used only in the context of a <Router> component.");let t=i.useContext(V),{basename:s,navigator:a}=i.useContext(T),{matches:n}=i.useContext(I),{pathname:r}=O(),l=JSON.stringify(je(n)),o=i.useRef(!1);return Ye(()=>{o.current=!0}),i.useCallback((c,u={})=>{if(L(o.current,Ke),!o.current)return;if(typeof c=="number"){a.go(c);return}let m=Ne(c,JSON.parse(l),r,u.relative==="path");t==null&&s!=="/"&&(m.pathname=m.pathname==="/"?s:q([s,m.pathname])),(u.replace?a.replace:a.push)(m,u.state,u)},[s,a,l,r,t])}i.createContext(null);function es(){let{matches:t}=i.useContext(I),s=t[t.length-1];return s?s.params:{}}function ee(t,{relative:s}={}){let{matches:a}=i.useContext(I),{pathname:n}=O(),r=JSON.stringify(je(a));return i.useMemo(()=>Ne(t,JSON.parse(r),n,s==="path"),[t,r,n,s])}function ts(t,s){return Ge(t,s)}function Ge(t,s,a,n,r){var x;P(_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=i.useContext(T),{matches:o}=i.useContext(I),d=o[o.length-1],c=d?d.params:{},u=d?d.pathname:"/",m=d?d.pathnameBase:"/",g=d&&d.route;{let f=g&&g.path||"";Xe(u,!g||f.endsWith("*")||f.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${f}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${f}"> to <Route path="${f==="/"?"*":`${f}/*`}">.`)}let h=O(),p;if(s){let f=typeof s=="string"?Q(s):s;P(m==="/"||((x=f.pathname)==null?void 0:x.startsWith(m)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${f.pathname}" was given in the \`location\` prop.`),p=f}else p=h;let y=p.pathname||"/",b=y;if(m!=="/"){let f=m.replace(/^\//,"").split("/");b="/"+y.replace(/^\//,"").split("/").slice(f.length).join("/")}let j=ze(t,{pathname:b});L(g||j!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),L(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let N=ls(j&&j.map(f=>Object.assign({},f,{params:Object.assign({},c,f.params),pathname:q([m,l.encodeLocation?l.encodeLocation(f.pathname).pathname:f.pathname]),pathnameBase:f.pathnameBase==="/"?m:q([m,l.encodeLocation?l.encodeLocation(f.pathnameBase).pathname:f.pathnameBase])})),o,a,n,r);return s&&N?i.createElement(X.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},N):N}function ss(){let t=ms(),s=Jt(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),a=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},l={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=i.createElement(i.Fragment,null,i.createElement("p",null,"💿 Hey developer 👋"),i.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",i.createElement("code",{style:l},"ErrorBoundary")," or"," ",i.createElement("code",{style:l},"errorElement")," prop on your route.")),i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},s),a?i.createElement("pre",{style:r},a):null,o)}var rs=i.createElement(ss,null),as=class extends i.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){this.props.unstable_onError?this.props.unstable_onError(t,s):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?i.createElement(I.Provider,{value:this.props.routeContext},i.createElement(ve.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function ns({routeContext:t,match:s,children:a}){let n=i.useContext(V);return n&&n.static&&n.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=s.route.id),i.createElement(I.Provider,{value:t},a)}function ls(t,s=[],a=null,n=null,r=null){if(t==null){if(!a)return null;if(a.errors)t=a.matches;else if(s.length===0&&!a.initialized&&a.matches.length>0)t=a.matches;else return null}let l=t,o=a==null?void 0:a.errors;if(o!=null){let u=l.findIndex(m=>m.route.id&&(o==null?void 0:o[m.route.id])!==void 0);P(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),l=l.slice(0,Math.min(l.length,u+1))}let d=!1,c=-1;if(a)for(let u=0;u<l.length;u++){let m=l[u];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(c=u),m.route.id){let{loaderData:g,errors:h}=a,p=m.route.loader&&!g.hasOwnProperty(m.route.id)&&(!h||h[m.route.id]===void 0);if(m.route.lazy||p){d=!0,c>=0?l=l.slice(0,c+1):l=[l[0]];break}}}return l.reduceRight((u,m,g)=>{let h,p=!1,y=null,b=null;a&&(h=o&&m.route.id?o[m.route.id]:void 0,y=m.route.errorElement||rs,d&&(c<0&&g===0?(Xe("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,b=null):c===g&&(p=!0,b=m.route.hydrateFallbackElement||null)));let j=s.concat(l.slice(0,g+1)),N=()=>{let x;return h?x=y:p?x=b:m.route.Component?x=i.createElement(m.route.Component,null):m.route.element?x=m.route.element:x=u,i.createElement(ns,{match:m,routeContext:{outlet:u,matches:j,isDataRoute:a!=null},children:x})};return a&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?i.createElement(as,{location:a.location,revalidation:a.revalidation,component:y,error:h,children:N(),routeContext:{outlet:null,matches:j,isDataRoute:!0},unstable_onError:n}):N()},null)}function we(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function os(t){let s=i.useContext(V);return P(s,we(t)),s}function is(t){let s=i.useContext(le);return P(s,we(t)),s}function cs(t){let s=i.useContext(I);return P(s,we(t)),s}function ke(t){let s=cs(t),a=s.matches[s.matches.length-1];return P(a.route.id,`${t} can only be used on routes that contain a unique "id"`),a.route.id}function ds(){return ke("useRouteId")}function ms(){var n;let t=i.useContext(ve),s=is("useRouteError"),a=ke("useRouteError");return t!==void 0?t:(n=s.errors)==null?void 0:n[a]}function us(){let{router:t}=os("useNavigate"),s=ke("useNavigate"),a=i.useRef(!1);return Ye(()=>{a.current=!0}),i.useCallback(async(r,l={})=>{L(a.current,Ke),a.current&&(typeof r=="number"?t.navigate(r):await t.navigate(r,{fromRouteId:s,...l}))},[t,s])}var Ue={};function Xe(t,s,a){!s&&!Ue[t]&&(Ue[t]=!0,L(!1,a))}i.memo(xs);function xs({routes:t,future:s,state:a,unstable_onError:n}){return Ge(t,void 0,a,n,s)}function pe({to:t,replace:s,state:a,relative:n}){P(_(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=i.useContext(T);L(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=i.useContext(I),{pathname:o}=O(),d=Z(),c=Ne(t,je(l),o,n==="path"),u=JSON.stringify(c);return i.useEffect(()=>{d(JSON.parse(u),{replace:s,state:a,relative:n})},[d,u,n,s,a]),null}function $(t){P(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function hs({basename:t="/",children:s=null,location:a,navigationType:n="POP",navigator:r,static:l=!1}){P(!_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),d=i.useMemo(()=>({basename:o,navigator:r,static:l,future:{}}),[o,r,l]);typeof a=="string"&&(a=Q(a));let{pathname:c="/",search:u="",hash:m="",state:g=null,key:h="default"}=a,p=i.useMemo(()=>{let y=M(c,o);return y==null?null:{location:{pathname:y,search:u,hash:m,state:g,key:h},navigationType:n}},[o,c,u,m,g,h,n]);return L(p!=null,`<Router basename="${o}"> is not able to match the URL "${c}${u}${m}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:i.createElement(T.Provider,{value:d},i.createElement(X.Provider,{children:s,value:p}))}function qe({children:t,location:s}){return ts(ge(t),s)}function ge(t,s=[]){let a=[];return i.Children.forEach(t,(n,r)=>{if(!i.isValidElement(n))return;let l=[...s,r];if(n.type===i.Fragment){a.push.apply(a,ge(n.props.children,l));return}P(n.type===$,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),P(!n.props.index||!n.props.children,"An index route cannot have child routes.");let o={id:n.props.id||l.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=ge(n.props.children,l)),a.push(o)}),a}var se="get",re="application/x-www-form-urlencoded";function oe(t){return t!=null&&typeof t.tagName=="string"}function ps(t){return oe(t)&&t.tagName.toLowerCase()==="button"}function gs(t){return oe(t)&&t.tagName.toLowerCase()==="form"}function fs(t){return oe(t)&&t.tagName.toLowerCase()==="input"}function bs(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function ys(t,s){return t.button===0&&(!s||s==="_self")&&!bs(t)}var te=null;function js(){if(te===null)try{new FormData(document.createElement("form"),0),te=!1}catch{te=!0}return te}var Ns=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ue(t){return t!=null&&!Ns.has(t)?(L(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${re}"`),null):t}function vs(t,s){let a,n,r,l,o;if(gs(t)){let d=t.getAttribute("action");n=d?M(d,s):null,a=t.getAttribute("method")||se,r=ue(t.getAttribute("enctype"))||re,l=new FormData(t)}else if(ps(t)||fs(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||d.getAttribute("action");if(n=c?M(c,s):null,a=t.getAttribute("formmethod")||d.getAttribute("method")||se,r=ue(t.getAttribute("formenctype"))||ue(d.getAttribute("enctype"))||re,l=new FormData(d,t),!js()){let{name:u,type:m,value:g}=t;if(m==="image"){let h=u?`${u}.`:"";l.append(`${h}x`,"0"),l.append(`${h}y`,"0")}else u&&l.append(u,g)}}else{if(oe(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=se,n=null,r=re,o=t}return l&&r==="text/plain"&&(o=l,l=void 0),{action:n,method:a.toLowerCase(),encType:r,formData:l,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ce(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function ws(t,s,a){let n=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n.pathname==="/"?n.pathname=`_root.${a}`:s&&M(n.pathname,s)==="/"?n.pathname=`${s.replace(/\/$/,"")}/_root.${a}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${a}`,n}async function ks(t,s){if(t.id in s)return s[t.id];try{let a=await import(t.module);return s[t.id]=a,a}catch(a){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Cs(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function Ss(t,s,a){let n=await Promise.all(t.map(async r=>{let l=s.routes[r.route.id];if(l){let o=await ks(l,a);return o.links?o.links():[]}return[]}));return $s(n.flat(1).filter(Cs).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Me(t,s,a,n,r,l){let o=(c,u)=>a[u]?c.route.id!==a[u].route.id:!0,d=(c,u)=>{var m;return a[u].pathname!==c.pathname||((m=a[u].route.path)==null?void 0:m.endsWith("*"))&&a[u].params["*"]!==c.params["*"]};return l==="assets"?s.filter((c,u)=>o(c,u)||d(c,u)):l==="data"?s.filter((c,u)=>{var g;let m=n.routes[c.route.id];if(!m||!m.hasLoader)return!1;if(o(c,u)||d(c,u))return!0;if(c.route.shouldRevalidate){let h=c.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((g=a[0])==null?void 0:g.params)||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function Ps(t,s,{includeHydrateFallback:a}={}){return Es(t.map(n=>{let r=s.routes[n.route.id];if(!r)return[];let l=[r.module];return r.clientActionModule&&(l=l.concat(r.clientActionModule)),r.clientLoaderModule&&(l=l.concat(r.clientLoaderModule)),a&&r.hydrateFallbackModule&&(l=l.concat(r.hydrateFallbackModule)),r.imports&&(l=l.concat(r.imports)),l}).flat(1))}function Es(t){return[...new Set(t)]}function Ds(t){let s={},a=Object.keys(t).sort();for(let n of a)s[n]=t[n];return s}function $s(t,s){let a=new Set;return new Set(s),t.reduce((n,r)=>{let l=JSON.stringify(Ds(r));return a.has(l)||(a.add(l),n.push({key:l,link:r})),n},[])}function Ze(){let t=i.useContext(V);return Ce(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Rs(){let t=i.useContext(le);return Ce(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Se=i.createContext(void 0);Se.displayName="FrameworkContext";function et(){let t=i.useContext(Se);return Ce(t,"You must render this element inside a <HydratedRouter> element"),t}function Ls(t,s){let a=i.useContext(Se),[n,r]=i.useState(!1),[l,o]=i.useState(!1),{onFocus:d,onBlur:c,onMouseEnter:u,onMouseLeave:m,onTouchStart:g}=s,h=i.useRef(null);i.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let b=N=>{N.forEach(x=>{o(x.isIntersecting)})},j=new IntersectionObserver(b,{threshold:.5});return h.current&&j.observe(h.current),()=>{j.disconnect()}}},[t]),i.useEffect(()=>{if(n){let b=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(b)}}},[n]);let p=()=>{r(!0)},y=()=>{r(!1),o(!1)};return a?t!=="intent"?[l,h,{}]:[l,h,{onFocus:K(d,p),onBlur:K(c,y),onMouseEnter:K(u,p),onMouseLeave:K(m,y),onTouchStart:K(g,p)}]:[!1,h,{}]}function K(t,s){return a=>{t&&t(a),a.defaultPrevented||s(a)}}function Ts({page:t,...s}){let{router:a}=Ze(),n=i.useMemo(()=>ze(a.routes,t,a.basename),[a.routes,t,a.basename]);return n?i.createElement(As,{page:t,matches:n,...s}):null}function Is(t){let{manifest:s,routeModules:a}=et(),[n,r]=i.useState([]);return i.useEffect(()=>{let l=!1;return Ss(t,s,a).then(o=>{l||r(o)}),()=>{l=!0}},[t,s,a]),n}function As({page:t,matches:s,...a}){let n=O(),{manifest:r,routeModules:l}=et(),{basename:o}=Ze(),{loaderData:d,matches:c}=Rs(),u=i.useMemo(()=>Me(t,s,c,r,n,"data"),[t,s,c,r,n]),m=i.useMemo(()=>Me(t,s,c,r,n,"assets"),[t,s,c,r,n]),g=i.useMemo(()=>{if(t===n.pathname+n.search+n.hash)return[];let y=new Set,b=!1;if(s.forEach(N=>{var f;let x=r.routes[N.route.id];!x||!x.hasLoader||(!u.some(v=>v.route.id===N.route.id)&&N.route.id in d&&((f=l[N.route.id])!=null&&f.shouldRevalidate)||x.hasClientLoader?b=!0:y.add(N.route.id))}),y.size===0)return[];let j=ws(t,o,"data");return b&&y.size>0&&j.searchParams.set("_routes",s.filter(N=>y.has(N.route.id)).map(N=>N.route.id).join(",")),[j.pathname+j.search]},[o,d,n,r,u,s,t,l]),h=i.useMemo(()=>Ps(m,r),[m,r]),p=Is(m);return i.createElement(i.Fragment,null,g.map(y=>i.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...a})),h.map(y=>i.createElement("link",{key:y,rel:"modulepreload",href:y,...a})),p.map(({key:y,link:b})=>i.createElement("link",{key:y,nonce:a.nonce,...b})))}function Fs(...t){return s=>{t.forEach(a=>{typeof a=="function"?a(s):a!=null&&(a.current=s)})}}var tt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{tt&&(window.__reactRouterVersion="7.8.2")}catch{}function Us({basename:t,children:s,window:a}){let n=i.useRef();n.current==null&&(n.current=Ct({window:a,v5Compat:!0}));let r=n.current,[l,o]=i.useState({action:r.action,location:r.location}),d=i.useCallback(c=>{i.startTransition(()=>o(c))},[o]);return i.useLayoutEffect(()=>r.listen(d),[r,d]),i.createElement(hs,{basename:t,children:s,location:l.location,navigationType:l.action,navigator:r})}var st=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,z=i.forwardRef(function({onClick:s,discover:a="render",prefetch:n="none",relative:r,reloadDocument:l,replace:o,state:d,target:c,to:u,preventScrollReset:m,viewTransition:g,...h},p){let{basename:y}=i.useContext(T),b=typeof u=="string"&&st.test(u),j,N=!1;if(typeof u=="string"&&b&&(j=u,tt))try{let E=new URL(window.location.href),F=u.startsWith("//")?new URL(E.protocol+u):new URL(u),B=M(F.pathname,y);F.origin===E.origin&&B!=null?u=B+F.search+F.hash:N=!0}catch{L(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let x=Xt(u,{relative:r}),[f,v,w]=Ls(n,h),C=Os(u,{replace:o,state:d,target:c,preventScrollReset:m,relative:r,viewTransition:g});function S(E){s&&s(E),E.defaultPrevented||C(E)}let A=i.createElement("a",{...h,...w,href:j||x,onClick:N||l?s:S,ref:Fs(p,v),target:c,"data-discover":!b&&a==="render"?"true":void 0});return f&&!b?i.createElement(i.Fragment,null,A,i.createElement(Ts,{page:x})):A});z.displayName="Link";var H=i.forwardRef(function({"aria-current":s="page",caseSensitive:a=!1,className:n="",end:r=!1,style:l,to:o,viewTransition:d,children:c,...u},m){let g=ee(o,{relative:u.relative}),h=O(),p=i.useContext(le),{navigator:y,basename:b}=i.useContext(T),j=p!=null&&Qs(g)&&d===!0,N=y.encodeLocation?y.encodeLocation(g).pathname:g.pathname,x=h.pathname,f=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;a||(x=x.toLowerCase(),f=f?f.toLowerCase():null,N=N.toLowerCase()),f&&b&&(f=M(f,b)||f);const v=N!=="/"&&N.endsWith("/")?N.length-1:N.length;let w=x===N||!r&&x.startsWith(N)&&x.charAt(v)==="/",C=f!=null&&(f===N||!r&&f.startsWith(N)&&f.charAt(N.length)==="/"),S={isActive:w,isPending:C,isTransitioning:j},A=w?s:void 0,E;typeof n=="function"?E=n(S):E=[n,w?"active":null,C?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let F=typeof l=="function"?l(S):l;return i.createElement(z,{...u,"aria-current":A,className:E,ref:m,style:F,to:o,viewTransition:d},typeof c=="function"?c(S):c)});H.displayName="NavLink";var qs=i.forwardRef(({discover:t="render",fetcherKey:s,navigate:a,reloadDocument:n,replace:r,state:l,method:o=se,action:d,onSubmit:c,relative:u,preventScrollReset:m,viewTransition:g,...h},p)=>{let y=Ws(),b=zs(d,{relative:u}),j=o.toLowerCase()==="get"?"get":"post",N=typeof d=="string"&&st.test(d),x=f=>{if(c&&c(f),f.defaultPrevented)return;f.preventDefault();let v=f.nativeEvent.submitter,w=(v==null?void 0:v.getAttribute("formmethod"))||o;y(v||f.currentTarget,{fetcherKey:s,method:w,navigate:a,replace:r,state:l,relative:u,preventScrollReset:m,viewTransition:g})};return i.createElement("form",{ref:p,method:j,action:b,onSubmit:n?c:x,...h,"data-discover":!N&&t==="render"?"true":void 0})});qs.displayName="Form";function Ms(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rt(t){let s=i.useContext(V);return P(s,Ms(t)),s}function Os(t,{target:s,replace:a,state:n,preventScrollReset:r,relative:l,viewTransition:o}={}){let d=Z(),c=O(),u=ee(t,{relative:l});return i.useCallback(m=>{if(ys(m,s)){m.preventDefault();let g=a!==void 0?a:G(c)===G(u);d(t,{replace:g,state:n,preventScrollReset:r,relative:l,viewTransition:o})}},[c,d,u,a,n,s,t,r,l,o])}var Bs=0,Hs=()=>`__${String(++Bs)}__`;function Ws(){let{router:t}=rt("useSubmit"),{basename:s}=i.useContext(T),a=ds();return i.useCallback(async(n,r={})=>{let{action:l,method:o,encType:d,formData:c,body:u}=vs(n,s);if(r.navigate===!1){let m=r.fetcherKey||Hs();await t.fetch(m,a,r.action||l,{preventScrollReset:r.preventScrollReset,formData:c,body:u,formMethod:r.method||o,formEncType:r.encType||d,flushSync:r.flushSync})}else await t.navigate(r.action||l,{preventScrollReset:r.preventScrollReset,formData:c,body:u,formMethod:r.method||o,formEncType:r.encType||d,replace:r.replace,state:r.state,fromRouteId:a,flushSync:r.flushSync,viewTransition:r.viewTransition})},[t,s,a])}function zs(t,{relative:s}={}){let{basename:a}=i.useContext(T),n=i.useContext(I);P(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),l={...ee(t||".",{relative:s})},o=O();if(t==null){l.search=o.search;let d=new URLSearchParams(l.search),c=d.getAll("index");if(c.some(m=>m==="")){d.delete("index"),c.filter(g=>g).forEach(g=>d.append("index",g));let m=d.toString();l.search=m?`?${m}`:""}}return(!t||t===".")&&r.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(l.pathname=l.pathname==="/"?a:q([a,l.pathname])),G(l)}function Qs(t,{relative:s}={}){let a=i.useContext(Je);P(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=rt("useViewTransitionState"),r=ee(t,{relative:s});if(!a.isTransitioning)return!1;let l=M(a.currentLocation.pathname,n)||a.currentLocation.pathname,o=M(a.nextLocation.pathname,n)||a.nextLocation.pathname;return ae(r.pathname,o)!=null||ae(r.pathname,l)!=null}const at=i.createContext(null),Vs=({children:t})=>{var g;const[s,a]=i.useState(null),[n,r]=i.useState(!0),l=Z(),o=h=>{console.log("🎯 === НАЧАЛО ОПРЕДЕЛЕНИЯ МАРШРУТА ==="),console.log("📊 Полные данные пользователя:",JSON.stringify(h,null,2)),console.log("🔍 user.role:",h.role),console.log("🔍 user.departmentId:",h.departmentId),console.log("🔍 user.department:",h.department);let p="/techcards";switch(h.role){case"admin":case"master":p="/admin",console.log("🔧 Определен как админ/мастер -> /admin");break;case"director":p="/dashboard",console.log("👔 Определен как директор -> /dashboard");break;case"employee":default:console.log("👨‍💼 Определен как сотрудник"),h.departmentId?(p=`/departments/${h.departmentId}`,console.log(`🏢 У сотрудника есть departmentId: ${h.departmentId}`),console.log(`🏢 Сформирован путь департамента: ${p}`)):(p="/techcards",console.log("❌ У сотрудника НЕТ departmentId -> /techcards"));break}return console.log("✅ ИТОГОВЫЙ ПУТЬ РЕДИРЕКТА:",p),console.log("🎯 === КОНЕЦ ОПРЕДЕЛЕНИЯ МАРШРУТА ==="),p},d=async(h=!1)=>{try{const p=localStorage.getItem("token");if(!p)return console.log("❌ Токен отсутствует в localStorage"),r(!1),null;console.log("🔄 === НАЧАЛО ЗАГРУЗКИ ДАННЫХ ПОЛЬЗОВАТЕЛЯ ==="),console.log("🔑 Токен найден:",p.substring(0,20)+"..."),console.log("🚀 shouldRedirect:",h);const y=await fetch("/api/users/me",{method:"GET",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}});if(console.log("📝 Ответ сервера:",y.status,y.statusText),y.ok){const b=await y.json();if(console.log("✅ RAW данные от сервера:",JSON.stringify(b,null,2)),b.user){const j={id:b.user.id,firstName:b.user.firstName,lastName:b.user.lastName,role:b.user.role,position:b.user.position,departmentId:b.user.departmentId,department:b.user.department};if(console.log("📋 Обработанные данные пользователя:",JSON.stringify(j,null,2)),a(j),console.log("✅ Пользователь установлен в состояние"),h){console.log("🚀 === НАЧАЛО ПРОЦЕССА РЕДИРЕКТА ==="),console.log("⏰ Текущий URL:",window.location.href);const N=o(j);console.log("🎯 Пытаемся перейти на:",N),console.log("🔄 Вызываем navigate..."),setTimeout(()=>{console.log("⏳ Выполняем navigate через setTimeout"),l(N),setTimeout(()=>{console.log("📍 URL после navigate:",window.location.href),console.log("🚀 === КОНЕЦ ПРОЦЕССА РЕДИРЕКТА ===")},1e3)},100)}return console.log("🔄 === КОНЕЦ ЗАГРУЗКИ ДАННЫХ ПОЛЬЗОВАТЕЛЯ ==="),j}else console.error("❌ В ответе сервера отсутствует user")}else{const b=await y.text();return console.error("❌ Ошибка получения данных:",y.status,b),localStorage.removeItem("token"),a(null),null}}catch(p){return console.error("❌ Ошибка запроса:",p),localStorage.removeItem("token"),a(null),null}finally{r(!1)}};i.useEffect(()=>{console.log("🚀 useEffect: Проверка авторизации при загрузке"),(async()=>{await d(!1)})()},[]);const m={user:s,isAuthenticated:!!s&&!n,login:async h=>{try{console.log("🔐 === НАЧАЛО ПРОЦЕССА ЛОГИНА ==="),console.log("🔑 Получен токен для логина:",h.substring(0,20)+"..."),r(!0),localStorage.setItem("token",h),console.log("💾 Токен сохранен в localStorage"),console.log("📡 Загружаем данные пользователя с редиректом..."),await d(!0),console.log("🔐 === КОНЕЦ ПРОЦЕССА ЛОГИНА ===")}catch(p){console.error("❌ Ошибка авторизации:",p),localStorage.removeItem("token"),a(null),r(!1)}},logout:()=>{console.log("👋 === НАЧАЛО ВЫХОДА ==="),console.log("🗑️ Удаляем токен из localStorage"),localStorage.removeItem("token"),a(null),console.log("🚪 Редирект на /login"),l("/login"),console.log("👋 === КОНЕЦ ВЫХОДА ===")},loading:n};return console.log("🔍 AuthContext состояние:",{user:s?{id:s.id,role:s.role,departmentId:s.departmentId,department:(g=s.department)==null?void 0:g.name}:null,loading:n,isAuthenticated:!!s&&!n}),e.jsx(at.Provider,{value:m,children:t})},R=()=>{const t=i.useContext(at);if(!t)throw new Error("useAuth должен использоваться внутри AuthProvider");return t},_s=()=>{const{user:t,logout:s}=R(),a=Z();return e.jsx("header",{className:"bg-blue-600 text-white",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between h-16 px-4",children:[e.jsx(z,{to:"/",className:"text-2xl font-bold",children:"АО «Металлург»"}),t?e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[t.firstName," ",t.lastName]}),t.department&&e.jsx(z,{to:`/departments/${t.department.id}`,className:"text-sm text-gray-200 hover:underline",children:t.department.name})]}),e.jsx("button",{onClick:()=>{s(),a("/login")},className:"px-3 py-1 bg-red-500 rounded hover:bg-red-600",children:"Выйти"})]}):e.jsx("button",{onClick:()=>a("/login"),className:"px-3 py-1 bg-green-500 rounded hover:bg-green-600",children:"Войти"})]})})},Js=()=>{const{user:t}=R(),s=O();return e.jsx("nav",{className:"bg-white border-b",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("ul",{className:"flex space-x-8",children:[(t==null?void 0:t.role)==="admin"?e.jsx("li",{children:e.jsx(H,{to:"/admin",className:({isActive:a})=>a||s.pathname.startsWith("/admin")?"text-blue-600 border-b-2 border-blue-600 pb-2 inline-block":"text-gray-600 hover:text-blue-600 pb-2 inline-block",children:"🔧 Админ-панель"})}):t!=null&&t.department?e.jsx("li",{children:e.jsxs(H,{to:`/departments/${t.department.id}`,className:({isActive:a})=>a||s.pathname.startsWith("/departments")?"text-blue-600 border-b-2 border-blue-600 pb-2 inline-block":"text-gray-600 hover:text-blue-600 pb-2 inline-block",children:["🏢 ",t.department.name]})}):null,e.jsx("li",{children:e.jsx(H,{to:"/assignments",className:({isActive:a})=>a?"text-blue-600 border-b-2 border-blue-600 pb-2 inline-block":"text-gray-600 hover:text-blue-600 pb-2 inline-block",children:"📋 Сменные задания"})}),e.jsx("li",{children:e.jsx(H,{to:"/techcards",className:({isActive:a})=>a||s.pathname.startsWith("/techcards")?"text-blue-600 border-b-2 border-blue-600 pb-2 inline-block":"text-gray-600 hover:text-blue-600 pb-2 inline-block",children:"🔧 Технологические карты"})}),e.jsx("li",{children:e.jsx(H,{to:"/documents",className:({isActive:a})=>a?"text-blue-600 border-b-2 border-blue-600 pb-2 inline-block":"text-gray-600 hover:text-blue-600 pb-2 inline-block",children:"📄 Документы"})}),e.jsx("li",{children:e.jsx(H,{to:"/profile",className:({isActive:a})=>a?"text-blue-600 border-b-2 border-blue-600 pb-2 inline-block":"text-gray-600 hover:text-blue-600 pb-2 inline-block",children:"👤 Профиль"})}),e.jsx("li",{children:e.jsx(H,{to:"/production-plans",className:({isActive:a})=>a?"text-blue-600 border-b-2 border-blue-600 pb-2 inline-block":"text-gray-600 hover:text-blue-600 pb-2 inline-block",children:"📊 Планы производства"})})]})})})},Ks=({user:t,onLogout:s})=>(console.log("MainPage получил пользователя:",t),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow",children:e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Библиотека регламентов"}),t?e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[t.firstName," ",t.lastName]}),t.department&&e.jsx("div",{className:"text-sm text-gray-600",children:t.department.name}),e.jsx("div",{className:"text-xs text-blue-600",children:t.role})]}),s&&e.jsx("button",{onClick:s,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:"Выйти"})]}):e.jsx("div",{children:"Добро пожаловать!"})]})}),e.jsx("main",{className:"container mx-auto p-4",children:t?e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl mb-4",children:["Добро пожаловать, ",t.firstName,"!"]}),t.role==="admin"&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-6",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-red-900",children:"🔧 Панель администратора"}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Управление пользователями"}),e.jsx("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Настройки системы"})]})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"📋 Производственные планы"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Управление производственными планами"})]}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("button",{className:"text-sm text-indigo-600 hover:text-indigo-900",children:"Перейти →"})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"🔧 Технологические карты"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Просмотр и создание техкарт"})]}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("button",{className:"text-sm text-indigo-600 hover:text-indigo-900",children:"Перейти →"})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"📖 База знаний"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Документация и инструкции"})]}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("button",{className:"text-sm text-indigo-600 hover:text-indigo-900",children:"Перейти →"})})]})]})]}):e.jsx("div",{children:e.jsx("div",{className:"text-center",children:e.jsx("h2",{className:"text-xl mb-4",children:"Войдите в систему"})})})})]})),Ys=({onLogin:t})=>{const[s,a]=i.useState(""),[n,r]=i.useState(""),[l,o]=i.useState(""),[d,c]=i.useState(!1),u=async m=>{m.preventDefault(),c(!0),o("");try{console.log("🔄 Отправка логина...",{username:s,password:n});const g=await fetch("/api/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s,password:n})});if(console.log("📝 Статус ответа:",g.status),g.ok){const h=await g.json();console.log("✅ Данные ответа:",h),h.token?(console.log("🔑 Токен получен, вызываем onLogin"),await t(h.token)):(console.error("❌ Токен не найден в ответе"),o("Токен не получен от сервера"))}else{const h=await g.json().catch(()=>({message:"Ошибка сервера"}));console.error("❌ Ошибка логина:",h),o(h.message||"Ошибка входа")}}catch(g){console.error("❌ Ошибка запроса:",g),o("Ошибка соединения с сервером")}finally{c(!1)}};return e.jsxs("div",{className:"max-w-md mx-auto bg-white p-8 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Вход в систему"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Логин"}),e.jsx("input",{type:"text",id:"username",value:s,onChange:m=>a(m.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введите логин"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Пароль"}),e.jsx("input",{type:"password",id:"password",value:n,onChange:m=>r(m.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Введите пароль"})]}),l&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:l}),e.jsx("button",{type:"submit",disabled:d,className:`w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${d?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}`,children:d?"Вход...":"Войти"})]})]})},Gs=({onLogin:t})=>{const s=async a=>{console.log("🎯 AuthSection: передаем токен в AuthContext:",a),await t(a)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"max-w-md w-full space-y-8",children:e.jsx(Ys,{onLogin:s})})})},Xs=({plan:t,onEdit:s,onDelete:a,onView:n,canEdit:r})=>{const l=u=>new Date(u).toLocaleDateString("ru-RU"),o=u=>u<30?"bg-red-500":u<70?"bg-yellow-500":"bg-green-500",d=Math.round(t.quantity*t.progressPercent/100),c=new Date(t.deadline)<new Date;return e.jsx("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 h-full",children:e.jsxs("div",{className:"p-6 flex flex-col h-full",children:[e.jsx("h5",{className:"text-xl font-bold text-gray-800 mb-3",children:t.orderName||"Без названия"}),e.jsx("div",{className:"space-y-2 mb-4",children:e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"font-medium",children:"Заказчик:"}),e.jsx("span",{className:"ml-2",children:t.customerName})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"flex justify-between items-center mb-1",children:e.jsxs("span",{className:"font-semibold",children:["Выполнено: ",t.progressPercent.toFixed(1),"%"]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-5",children:e.jsxs("div",{className:`h-5 rounded-full ${o(t.progressPercent)} flex items-center justify-center text-white text-xs font-medium`,style:{width:`${t.progressPercent}%`},children:[t.progressPercent.toFixed(1),"%"]})}),e.jsxs("small",{className:"text-gray-500 text-sm",children:[d," из ",t.quantity," шт."]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"font-medium",children:"Срок:"}),e.jsx("span",{className:"ml-2",children:l(t.deadline)})]}),c&&e.jsx("span",{className:"bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:"Просрочен"})]}),e.jsxs("div",{className:"mt-auto pt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>n(t.id),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center gap-1 transition-colors",children:"👁️ Подробнее"}),r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s==null?void 0:s(t),className:"bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center gap-1 transition-colors",children:"✏️ Редактировать"}),e.jsx("button",{onClick:()=>a==null?void 0:a(t.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center gap-1 transition-colors",children:"🗑️ Удалить"})]})]})]})})},Zs=({onSubmit:t,onClose:s})=>{const[a,n]=i.useState({orderName:"",customerName:"",quantity:"",deadline:""}),r=o=>{o.preventDefault();const d={orderName:a.orderName,customerName:a.customerName,quantity:parseInt(a.quantity),deadline:a.deadline};t(d)},l=o=>{n({...a,[o.target.name]:o.target.value})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Создать новый план"}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700",children:e.jsx(He,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Название заказа *"}),e.jsx("input",{type:"text",name:"orderName",value:a.orderName,onChange:l,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Заказчик *"}),e.jsx("input",{type:"text",name:"customerName",value:a.customerName,onChange:l,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Количество *"}),e.jsx("input",{type:"number",name:"quantity",value:a.quantity,onChange:l,required:!0,min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Срок выполнения *"}),e.jsx("input",{type:"date",name:"deadline",value:a.deadline,onChange:l,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-md font-medium transition-colors",children:"Создать"}),e.jsx("button",{type:"button",onClick:s,className:"flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-md font-medium transition-colors",children:"Отмена"})]})]})]})})},er=({plans:t,userRole:s,onCreatePlan:a,onUpdatePlan:n,onDeletePlan:r,onViewPlan:l})=>{const[o,d]=i.useState(!1),[c,u]=i.useState(null),[m,g]=i.useState(null),h=s==="admin"||s==="director",p=j=>{a(j),d(!1)},y=j=>{const N=prompt("Новое название заказа:",j.orderName),x=prompt("Новый заказчик:",j.customerName);if(N&&x){const f={orderName:N,customerName:x,quantity:j.quantity,deadline:j.deadline};n(j.id,f)}},b=j=>{window.confirm("Вы уверены, что хотите удалить этот план?")&&r(j)};return e.jsxs("div",{className:"container mx-auto mt-4 px-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Список производственных планов"}),h&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>d(!0),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md font-medium flex items-center gap-2 transition-colors",children:[e.jsx(pt,{className:"w-4 h-4"}),"Создать новый план"]}),e.jsxs("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md font-medium flex items-center gap-2 transition-colors",onClick:()=>alert("Функция загрузки из Excel будет добавлена позже"),children:[e.jsx(gt,{className:"w-4 h-4"}),"Загрузить из Excel"]})]})]}),t.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(j=>e.jsx(Xs,{plan:j,canEdit:h,onView:l,onEdit:y,onDelete:b},j.id))}):e.jsx("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-md",children:"Нет доступных производственных планов"}),o&&e.jsx(Zs,{onSubmit:p,onClose:()=>d(!1)})]})},tr=()=>{const[t,s]=i.useState([]),[a,n]=i.useState(!0),[r,l]=i.useState(""),{user:o}=R(),d=(o==null?void 0:o.role)||"employee";i.useEffect(()=>{c()},[]);const c=async()=>{try{n(!0),l("");const p=localStorage.getItem("token");if(!p){l("Токен авторизации не найден");return}console.log("🔄 Загрузка планов производства из API...");const y=await fetch("/api/productionPlans",{method:"GET",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}});if(console.log("📝 Статус ответа API:",y.status),y.ok){const b=await y.json();console.log("✅ Получены планы из БД:",b);const j=b.map(N=>({id:N.id,orderName:N.orderName,customerName:N.customerName,quantity:N.quantity,deadline:new Date(N.deadline).toISOString().split("T")[0],progressPercent:N.progressPercent||0}));s(j),console.log(`📊 Загружено ${j.length} планов производства`)}else{const b=await y.json().catch(()=>({error:"Ошибка сервера"}));l(b.error||`Ошибка ${y.status}`),console.error("❌ Ошибка загрузки планов:",y.status,b)}}catch(p){console.error("❌ Ошибка запроса планов:",p),l("Ошибка соединения с сервером")}finally{n(!1)}},u=async p=>{try{const y=localStorage.getItem("token"),b=await fetch("/api/productionPlans",{method:"POST",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"},body:JSON.stringify(p)});if(b.ok)console.log("✅ План создан успешно"),await c();else{const j=await b.json();console.error("❌ Ошибка создания плана:",j),alert(`Ошибка создания плана: ${j.error}`)}}catch(y){console.error("❌ Ошибка создания плана:",y),alert("Ошибка соединения с сервером")}},m=async(p,y)=>{try{const b=localStorage.getItem("token"),j=await fetch(`/api/productionPlans/${p}`,{method:"PUT",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify(y)});if(j.ok)console.log("✅ План обновлен успешно"),await c();else{const N=await j.json();console.error("❌ Ошибка обновления плана:",N),alert(`Ошибка обновления плана: ${N.error}`)}}catch(b){console.error("❌ Ошибка обновления плана:",b),alert("Ошибка соединения с сервером")}},g=async p=>{if(confirm("Вы уверены, что хотите удалить этот план?"))try{const y=localStorage.getItem("token"),b=await fetch(`/api/productionPlans/${p}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}});if(b.ok)console.log("✅ План удален успешно"),await c();else{const j=await b.json();console.error("❌ Ошибка удаления плана:",j),alert(`Ошибка удаления плана: ${j.error}`)}}catch(y){console.error("❌ Ошибка удаления плана:",y),alert("Ошибка соединения с сервером")}},h=p=>{console.log("👁️ Просмотр плана",p),alert(`Переход к детальной странице плана ${p}`)};return a?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"text-lg",children:"Загрузка планов производства..."})}):r?e.jsxs("div",{className:"flex flex-col justify-center items-center p-8",children:[e.jsxs("div",{className:"text-red-600 text-lg mb-4",children:["❌ ",r]}),e.jsx("button",{onClick:c,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Попробовать снова"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"📋 Планы производства"}),e.jsxs("p",{className:"text-gray-600",children:["Всего планов: ",e.jsx("span",{className:"font-semibold",children:t.length})]})]}),e.jsx(er,{plans:t,userRole:d,onCreatePlan:u,onUpdatePlan:m,onDeletePlan:g,onViewPlan:h})]})},sr=()=>{var l;const{user:t,logout:s,loading:a}=R(),[n,r]=i.useState(t);return i.useEffect(()=>{t&&r(t)},[t]),a?e.jsx("div",{children:"Загрузка профиля…"}):n?e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Профиль"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Имя:"})," ",n.firstName]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Фамилия:"})," ",n.lastName]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Роль:"})," ",n.role]}),e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:"Департамент:"})," ",((l=n.department)==null?void 0:l.name)||"не указан"]}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"Выйти"})]})]}):e.jsx("div",{children:"Не авторизован"})},rr=({isOpen:t,onClose:s,currentView:a,onHomeClick:n})=>{const[r,l]=i.useState(!0),o=()=>{l(!r)},d=["fixed top-16 left-0 h-[calc(100vh-4rem)] bg-gray-800 text-white transition-all duration-300 ease-in-out z-50",t?"translate-x-0":"-translate-x-full",r?"w-12":"w-64","lg:translate-x-0"].join(" "),c=["transition-opacity duration-200 p-4",r?"opacity-0 pointer-events-none":"opacity-100"].join(" ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:d,children:[e.jsx("button",{onClick:o,className:"absolute -right-3 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white w-6 h-12 rounded-r-lg flex items-center justify-center shadow-md hover:bg-gray-700 focus:outline-none","aria-label":r?"Развернуть меню":"Свернуть меню",children:r?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),!r&&e.jsx("button",{onClick:s,className:"lg:hidden absolute top-4 right-4 text-gray-400 hover:text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:c,children:e.jsx("nav",{className:"mt-8",children:e.jsx("ul",{children:e.jsx("li",{className:"mb-2",children:e.jsx("a",{href:"#",onClick:u=>{u.preventDefault(),n()},className:a==="positions"?"bg-blue-600 block px-4 py-2 rounded-md":"hover:bg-gray-700 block px-4 py-2 rounded-md",children:"Должности"})})})})}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center pt-8 space-y-4",children:e.jsx("button",{onClick:u=>{u.preventDefault(),n(),r&&o()},className:"w-8 h-8 flex items-center justify-center hover:bg-gray-700 rounded-md group",title:"Должности",children:e.jsx("svg",{className:"w-5 h-5 text-gray-300 group-hover:text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})})})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:s})]})},ar={Users:"👥",DollarSign:"💰",Shield:"🛡️",Settings:"⚙️"},nr=({position:t,onClick:s})=>e.jsxs("div",{className:"relative bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg border-2 border-amber-200 p-6 hover:shadow-lg transition-all duration-300 cursor-pointer hover:from-amber-100 hover:to-amber-150 group",onClick:()=>s(t),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-amber-100 via-amber-200 to-amber-300 rounded-lg opacity-20"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 bg-gradient-to-r from-transparent via-amber-400 to-transparent opacity-30 rounded-b-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 ${t.color} rounded-lg flex items-center justify-center text-white text-lg shadow-md`,children:ar[t.icon]||"📋"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.department})]})]}),e.jsx("div",{className:"text-2xl group-hover:scale-110 transition-transform",children:"📚"})]}),e.jsx("div",{className:"flex space-x-3 justify-center",children:t.folders.map((a,n)=>e.jsxs("div",{className:`w-16 h-20 ${a.color} rounded-t-lg shadow-md flex flex-col items-center justify-center text-white transform hover:scale-105 transition-transform`,style:{transform:`rotate(${n%2===0?"-2deg":"2deg"})`},children:[e.jsx("div",{className:"text-lg mb-1",children:a.type==="employee"?"👤":"📋"}),e.jsx("div",{className:"text-xs text-center font-medium leading-tight",children:a.type==="employee"?"Сотрудник":"Должность"})]},a.id))}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[t.folders.reduce((a,n)=>a+n.documents.length,0)," документов"]})})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),lr=({folders:t,positionName:s,onFolderClick:a,onBackClick:n})=>e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-4",children:e.jsxs("button",{onClick:n,className:"flex items-center space-x-2 text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx(ft,{className:"w-4 h-4"}),e.jsx("span",{children:"Назад к полкам"})]})}),e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:["Папки должности: ",s]}),e.jsx("p",{className:"text-gray-600",children:"Выберите папку для просмотра документов"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:t.map(r=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg border-2 border-gray-200 p-8 hover:shadow-lg transition-all duration-300 cursor-pointer hover:from-gray-100 hover:to-gray-150 group",onClick:()=>a(r),children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-24 h-24 ${r.color} rounded-lg flex items-center justify-center text-white text-4xl mx-auto mb-4 shadow-lg group-hover:scale-110 transition-transform`,children:r.type==="employee"?"👤":"📋"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:r.name}),e.jsx("p",{className:"text-gray-600 mb-4",children:r.type==="employee"?"Документы штатного сотрудника":"Документы должности"}),e.jsx("div",{className:"bg-white rounded-full px-4 py-2 inline-block shadow-sm",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["📄 ",r.documents.length," документов"]})}),e.jsx("div",{className:"mt-4 text-left",children:e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"Содержимое:"}),e.jsxs("ul",{className:"space-y-1",children:[r.documents.slice(0,3).map(l=>e.jsxs("li",{className:"text-xs text-gray-600 flex items-center space-x-2",children:[e.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full"}),e.jsx("span",{className:"truncate",children:l.title})]},l.id)),r.documents.length>3&&e.jsxs("li",{className:"text-xs text-gray-500 italic",children:["и еще ",r.documents.length-3," документов..."]})]})]})})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 to-purple-500/5 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]},r.id))})]}),or=({page:t,onClick:s})=>{const a=r=>{switch(r){case"published":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"archived":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},n=r=>{switch(r){case"published":return"Опубликован";case"draft":return"Черновик";case"archived":return"Архив";default:return r}};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-all duration-200 cursor-pointer hover:border-blue-300",onClick:()=>s(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:t.author})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(t.updatedAt).toLocaleDateString("ru-RU")})]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a(t.status)}`,children:n(t.status)})]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:[t.content.replace(/[#*]/g,"").substring(0,150),"..."]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(We,{className:"w-3 h-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.tags.slice(0,2).join(", "),t.tags.length>2&&` +${t.tags.length-2}`]})]})}),e.jsxs("button",{className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-sm font-medium",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{children:"Читать"})]})]})]})},ir=({page:t,isOpen:s,onClose:a})=>{if(!s||!t)return null;const n=o=>{switch(o){case"published":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"archived":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},r=o=>{switch(o){case"published":return"Опубликован";case"draft":return"Черновик";case"archived":return"Архив";default:return o}},l=o=>o.split(`
`).map((d,c)=>d.startsWith("# ")?e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4 mt-6",children:d.substring(2)},c):d.startsWith("## ")?e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-3 mt-5",children:d.substring(3)},c):d.startsWith("### ")?e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2 mt-4",children:d.substring(4)},c):d.startsWith("- ")?e.jsx("li",{className:"ml-4 text-gray-600 mb-1",children:d.substring(2)},c):d.match(/^\d+\. /)?e.jsx("li",{className:"ml-4 text-gray-600 mb-1 list-decimal",children:d.replace(/^\d+\. /,"")},c):d.startsWith("   - ")?e.jsx("li",{className:"ml-8 text-gray-600 mb-1 list-disc",children:d.substring(5)},c):d.startsWith("**")&&d.endsWith("**")?e.jsx("p",{className:"font-semibold text-gray-800 mb-2",children:d.slice(2,-2)},c):d.trim()===""?e.jsx("br",{},c):e.jsx("p",{className:"text-gray-600 mb-2 leading-relaxed",children:d},c));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${n(t.status)}`,children:r(t.status)})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:t.author})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:["Обновлено: ",new Date(t.updatedAt).toLocaleDateString("ru-RU")]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),e.jsx("span",{children:"Редактировать"})]}),e.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(He,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[e.jsx("div",{className:"prose max-w-none",children:l(t.content)}),t.tags.length>0&&e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Теги:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.tags.map((o,d)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs",children:o},d))})]})})]})]})})},cr=[{id:"1",title:"Должностная инструкция HR-менеджера",content:`# Должностная инструкция HR-менеджера

## Общие положения
HR-менеджер подчиняется директору по персоналу и отвечает за управление человеческими ресурсами.

## Основные обязанности
1. **Подбор персонала**
   - Размещение вакансий
   - Проведение собеседований
   - Оценка кандидатов

2. **Адаптация новых сотрудников**
   - Проведение вводного инструктажа
   - Контроль прохождения испытательного срока
   - Организация обучения

3. **Документооборот**
   - Ведение личных дел сотрудников
   - Подготовка приказов
   - Контроль трудовых договоров

## Требования к должности
- Высшее образование
- Опыт работы в HR от 2 лет
- Знание трудового законодательства`,category:"hr",tags:["должностная","HR","менеджер"],author:"Анна Петрова",createdAt:"2024-01-15",updatedAt:"2024-01-20",status:"published"},{id:"2",title:"Процедура найма новых сотрудников",content:`# Процедура найма новых сотрудников

## Этапы найма
1. Подача заявки на найм
2. Поиск кандидатов
3. Отбор резюме
4. Проведение собеседований
5. Принятие решения
6. Оформление документов

## Ответственные лица
- HR-менеджер: координация процесса
- Руководитель подразделения: техническое интервью
- Директор: финальное решение`,category:"hr",tags:["найм","процедура","сотрудники"],author:"Анна Петрова",createdAt:"2024-01-10",updatedAt:"2024-01-18",status:"published"}],dr=[{id:"3",title:"Личное дело: Анна Петрова",content:`# Личное дело сотрудника

## Персональные данные
**ФИО:** Петрова Анна Сергеевна
**Должность:** HR-менеджер
**Дата приема:** 15.03.2020
**Образование:** Высшее, МГУ, психология

## Трудовая деятельность
- 2020-настоящее время: HR-менеджер
- Повышения: нет
- Взыскания: нет

## Обучение и сертификаты
- Сертификат по трудовому праву (2023)
- Курс по подбору персонала (2022)`,category:"hr",tags:["личное дело","сотрудник"],author:"Система",createdAt:"2024-01-01",updatedAt:"2024-01-25",status:"published"},{id:"4",title:"График отпусков HR-отдела",content:`# График отпусков HR-отдела на 2024 год

## Анна Петрова
- Основной отпуск: 15.07.2024 - 05.08.2024 (21 день)
- Дополнительные дни: 23.12.2024 - 08.01.2025

## Планируемые замещения
- На период отпуска А.Петровой: М.Сидоров (временно)`,category:"hr",tags:["отпуск","график","планирование"],author:"Анна Петрова",createdAt:"2024-01-05",updatedAt:"2024-01-15",status:"published"}],mr=[{id:"5",title:"Должностная инструкция бухгалтера",content:`# Должностная инструкция бухгалтера

## Общие положения
Бухгалтер подчиняется главному бухгалтеру и отвечает за ведение учета.

## Основные обязанности
1. **Первичная документация**
   - Обработка первичных документов
   - Проверка правильности оформления
   - Ввод данных в учетную систему

2. **Расчеты с контрагентами**
   - Ведение расчетов с поставщиками
   - Контроль дебиторской задолженности
   - Сверка взаиморасчетов

3. **Отчетность**
   - Подготовка внутренней отчетности
   - Участие в составлении налоговых деклараций`,category:"finance",tags:["должностная","бухгалтер","учет"],author:"Михаил Сидоров",createdAt:"2024-01-12",updatedAt:"2024-01-22",status:"published"},{id:"6",title:"Регламент работы с корпоративными картами",content:`# Регламент работы с корпоративными картами

## Получение карты
1. Подача заявления
2. Согласование с руководителем
3. Оформление в банке

## Правила использования
- Только служебные расходы
- Сохранение всех чеков
- Месячная отчетность

## Ответственность
Нарушение правил влечет дисциплинарные меры.`,category:"finance",tags:["карты","расходы","регламент"],author:"Михаил Сидоров",createdAt:"2024-01-08",updatedAt:"2024-01-16",status:"published"}],ur=[{id:"7",title:"Личное дело: Михаил Сидоров",content:`# Личное дело сотрудника

## Персональные данные
**ФИО:** Сидоров Михаил Александрович
**Должность:** Бухгалтер
**Дата приема:** 10.09.2019
**Образование:** Высшее, Финансовый университет

## Трудовая деятельность
- 2019-настоящее время: Бухгалтер
- Повышения: нет
- Взыскания: нет

## Сертификаты
- 1С:Бухгалтерия 8.3 (2023)
- Налоговое планирование (2022)`,category:"finance",tags:["личное дело","бухгалтер"],author:"Система",createdAt:"2024-01-01",updatedAt:"2024-01-20",status:"published"}],xr=[{id:"8",title:"Должностная инструкция системного администратора",content:`# Должностная инструкция системного администратора

## Общие положения
Системный администратор отвечает за функционирование IT-инфраструктуры.

## Основные обязанности
1. **Администрирование серверов**
   - Настройка и обслуживание серверов
   - Мониторинг производительности
   - Резервное копирование

2. **Поддержка пользователей**
   - Решение технических проблем
   - Установка ПО
   - Обучение сотрудников

3. **Информационная безопасность**
   - Настройка антивирусной защиты
   - Контроль доступа к системам
   - Обновление безопасности`,category:"it",tags:["должностная","системный администратор","IT"],author:"Елена Козлова",createdAt:"2024-01-14",updatedAt:"2024-01-24",status:"published"},{id:"9",title:"Политика информационной безопасности",content:`# Политика информационной безопасности

## Основные принципы
1. Конфиденциальность
2. Целостность
3. Доступность

## Требования к паролям
- Минимум 8 символов
- Спецсимволы обязательны
- Смена каждые 90 дней

## Контроль доступа
- Принцип минимальных привилегий
- Регулярный аудит прав доступа`,category:"it",tags:["безопасность","политика","доступ"],author:"Елена Козлова",createdAt:"2024-01-11",updatedAt:"2024-01-21",status:"published"}],hr=[{id:"10",title:"Личное дело: Елена Козлова",content:`# Личное дело сотрудника

## Персональные данные
**ФИО:** Козлова Елена Викторовна
**Должность:** Системный администратор
**Дата приема:** 05.11.2021
**Образование:** Высшее, МГТУ им. Баумана

## Трудовая деятельность
- 2021-настоящее время: Системный администратор
- Повышения: нет
- Взыскания: нет

## Сертификаты
- Microsoft Certified (2023)
- Cisco CCNA (2022)`,category:"it",tags:["личное дело","системный администратор"],author:"Система",createdAt:"2024-01-01",updatedAt:"2024-01-23",status:"published"}],pr=[{id:"1",name:"HR-менеджер",department:"Отдел кадров",icon:"Users",color:"bg-blue-500",folders:[{id:"1-1",name:"Папка штатного сотрудника",type:"employee",documents:dr,icon:"User",color:"bg-green-500"},{id:"1-2",name:"Папка должности",type:"position",documents:cr,icon:"FileText",color:"bg-blue-500"}]},{id:"2",name:"Бухгалтер",department:"Финансовый отдел",icon:"DollarSign",color:"bg-green-500",folders:[{id:"2-1",name:"Папка штатного сотрудника",type:"employee",documents:ur,icon:"User",color:"bg-green-500"},{id:"2-2",name:"Папка должности",type:"position",documents:mr,icon:"FileText",color:"bg-green-500"}]},{id:"3",name:"Системный администратор",department:"IT-отдел",icon:"Shield",color:"bg-purple-500",folders:[{id:"3-1",name:"Папка штатного сотрудника",type:"employee",documents:hr,icon:"User",color:"bg-green-500"},{id:"3-2",name:"Папка должности",type:"position",documents:xr,icon:"FileText",color:"bg-purple-500"}]}],gr=()=>{const[t,s]=i.useState(!1),[a,n]=i.useState("positions"),[r,l]=i.useState(null),[o,d]=i.useState(null),[c,u]=i.useState(""),[m,g]=i.useState(null),[h,p]=i.useState(!1),y=i.useMemo(()=>{if(!o||!c.trim())return(o==null?void 0:o.documents)||[];const v=c.toLowerCase();return o.documents.filter(w=>w.title.toLowerCase().includes(v)||w.content.toLowerCase().includes(v)||w.tags.some(C=>C.toLowerCase().includes(v)))},[o,c]),b=v=>{l(v),n("folders")},j=v=>{d(v),n("documents")},N=()=>{n("positions"),l(null),d(null),u("")},x=v=>{g(v),p(!0)},f=()=>{p(!1),g(null)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(rr,{isOpen:t,onClose:()=>s(!1),currentView:a,onHomeClick:N}),e.jsxs("main",{className:"flex-1 p-6",children:[a==="positions"&&e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Книжные полки регламентов"}),e.jsx("p",{className:"text-gray-600",children:"Выберите должность для просмотра документов"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:pr.map(v=>e.jsx(nr,{position:v,onClick:b},v.id))})]}),a==="folders"&&r&&e.jsx(lr,{folders:r.folders,positionName:r.name,onFolderClick:j,onBackClick:N}),a==="documents"&&o&&e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:o.name}),e.jsx("p",{className:"text-gray-600",children:c?`Найдено ${y.length} документов по запросу "${c}"`:`${y.length} документов доступно`})]}),y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-4xl text-gray-400",children:"📄"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:c?"Ничего не найдено":"Нет документов"}),e.jsx("p",{className:"text-gray-500",children:c?"Попробуйте изменить поисковый запрос":"В этой папке пока нет документов"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(v=>e.jsx(or,{page:v,onClick:x},v.id))})]})]}),e.jsx(ir,{page:m,isOpen:h,onClose:f})]})},W="/api",fr=t=>{if(t.startsWith("http"))return t;const s="/api";return s.startsWith("http")?`${s.replace("/api","")}/api/files${t}`:`${window.location.origin}/api/files${t}`},J=()=>{const t=localStorage.getItem("token");return{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}}},br=()=>{const t=localStorage.getItem("token");return{...t&&{Authorization:`Bearer ${t}`}}},nt=async t=>{let s=`${W}/techcards`;const a=await fetch(s,{headers:J()});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()},Oe=async t=>{const s=await fetch(`${W}/techcards/${t}`,{headers:J()});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return s.json()},yr=async t=>{const s=await fetch(`${W}/techcards`,{method:"POST",headers:J(),body:JSON.stringify({...t,priority:t.priority||"medium"})});if(!s.ok)throw new Error("Failed to create tech card");return s.json()},lt=async(t,s)=>{const a=await fetch(`${W}/techcards/${t}`,{method:"PUT",headers:J(),body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to update tech card");return a.json()},ot=async t=>{const s=await fetch(`${W}/techcards/${t}`,{method:"DELETE",headers:J()});if(!s.ok)throw new Error("Failed to delete tech card");return s.json()},jr=async(t,s)=>{const a=await fetch(`${W}/techcards/${t}/executions`,{method:"POST",headers:J(),body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to add execution");return a.json()},Nr=async(t,s)=>{const a=new FormData;a.append("pdf",s);const n=await fetch(`${W}/techcards/${t}/upload-pdf`,{method:"POST",headers:br(),body:a});if(!n.ok){const r=await n.json();throw new Error(r.error||"Failed to upload PDF")}return n.json()},it=async(t,s)=>lt(t,{status:s}),Pe=t=>t.quantity===0?0:Math.round(t.totalProducedQuantity/t.quantity*100),ne=t=>!t.plannedEndDate||t.actualEndDate||t.status!=="active"?!1:new Date(t.plannedEndDate)<new Date,Ee=t=>{if(!t.plannedEndDate||t.actualEndDate)return null;const s=new Date,n=new Date(t.plannedEndDate).getTime()-s.getTime();return Math.ceil(n/(1e3*60*60*24))},vr=t=>{if(!t)return"Неизвестно";const s=["Б","КБ","МБ","ГБ"];let a=t,n=0;for(;a>=1024&&n<s.length-1;)a/=1024,n++;return`${a.toFixed(1)} ${s[n]}`},Y=t=>({low:"#10b981",medium:"#f59e0b",high:"#f97316",urgent:"#ef4444"})[t],wr=({techCards:t,onView:s,onEdit:a})=>{const n=l=>({low:"🟢 Низкий",medium:"🟡 Средний",high:"🟠 Высокий",urgent:"🔴 Срочный"})[l]||l,r=l=>{switch(l){case"draft":return"📝 Черновик";case"active":return"✅ Активная";case"archived":return"📁 Архив";default:return l}};return t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📄"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Техкарты не найдены"}),e.jsx("p",{className:"text-gray-500",children:"Пока нет созданных техкарт"})]}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:t.map(l=>{const o=Pe(l),d=ne(l),c=Ee(l);return e.jsxs("div",{className:"bg-white rounded-lg border shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:()=>s==null?void 0:s(l),children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-2",children:l.productName}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full ml-2",style:{backgroundColor:`${Y(l.priority)}20`,color:Y(l.priority)},children:n(l.priority)})]}),l.partNumber&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["🏷️ ",l.partNumber]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Заказчик:"})," ",l.customer]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Заказ:"})," ",l.order]})]})]}),e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Прогресс"}),e.jsxs("span",{className:"text-sm text-gray-900",children:[l.totalProducedQuantity," / ",l.quantity," (",o,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${o>=100?"bg-green-500":o>=75?"bg-blue-500":o>=50?"bg-yellow-500":o>=25?"bg-orange-500":"bg-red-500"}`,style:{width:`${Math.min(o,100)}%`}})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded bg-gray-100 text-gray-800",children:r(l.status)}),l.pdfUrl&&e.jsx("span",{className:"text-xs text-purple-600",children:"📄 PDF"})]}),l.plannedEndDate&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["📅 План: ",new Date(l.plannedEndDate).toLocaleDateString("ru-RU"),c!==null&&!l.actualEndDate&&e.jsx("div",{className:`mt-1 ${d?"text-red-600 font-medium":"text-gray-600"}`,children:c<0?`⚠️ Просрочено на ${Math.abs(c)} дн.`:`⏰ Осталось ${c} дн.`})]}),a&&e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsx("button",{onClick:u=>{u.stopPropagation(),a(l)},className:"text-sm text-blue-600 hover:text-blue-800",children:"✏️ Редактировать"})})]})]},l.id)})})},fe=({techCard:t,isEdit:s=!1,onClose:a,onSuccess:n})=>{const[r,l]=i.useState({customer:(t==null?void 0:t.customer)||"",order:(t==null?void 0:t.order)||"",productName:(t==null?void 0:t.productName)||"",partNumber:(t==null?void 0:t.partNumber)||"",quantity:(t==null?void 0:t.quantity)||1,description:(t==null?void 0:t.description)||"",priority:(t==null?void 0:t.priority)||"medium",status:(t==null?void 0:t.status)||"draft",plannedEndDate:t!=null&&t.plannedEndDate?t.plannedEndDate.split("T")[0]:"",notes:(t==null?void 0:t.notes)||"",file:void 0}),[o,d]=i.useState(!1),c=async m=>{if(m.preventDefault(),!r.customer||!r.order||!r.productName||!r.quantity){alert("Заполните все обязательные поля");return}try{d(!0);let g;if(s&&t?g=await lt(t.id.toString(),{customer:r.customer,order:r.order,productName:r.productName,partNumber:r.partNumber||void 0,quantity:Number(r.quantity),description:r.description||void 0,priority:r.priority,status:r.status,plannedEndDate:r.plannedEndDate||void 0,notes:r.notes||void 0}):g=await yr({customer:r.customer,order:r.order,productName:r.productName,partNumber:r.partNumber||void 0,quantity:Number(r.quantity),description:r.description||void 0,priority:r.priority,status:r.status,plannedEndDate:r.plannedEndDate||void 0,notes:r.notes||void 0}),r.file)try{await Nr(g.id.toString(),r.file)}catch(h){console.error("Ошибка загрузки файла:",h),alert("Техкарта сохранена, но файл не загружен. Попробуйте позже.")}a(),n&&n()}catch(g){console.error("Ошибка при сохранении:",g),alert("Ошибка при сохранении техкарты")}finally{d(!1)}},u=m=>{var h;const g=(h=m.target.files)==null?void 0:h[0];if(g){if(g.size>10*1024*1024){alert("Файл слишком большой. Максимальный размер: 10MB");return}if(g.type!=="application/pdf"){alert("Разрешены только PDF файлы");return}l({...r,file:g})}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s?"✏️ Редактирование техкарты":"✨ Создание техкарты"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"✕"})]}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 border-b pb-2",children:"📝 Основная информация"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Заказчик *"}),e.jsx("input",{type:"text",value:r.customer,onChange:m=>l({...r,customer:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Введите название заказчика",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Номер заказа *"}),e.jsx("input",{type:"text",value:r.order,onChange:m=>l({...r,order:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Введите номер заказа",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Название продукта *"}),e.jsx("input",{type:"text",value:r.productName,onChange:m=>l({...r,productName:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Введите название изделия",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Артикул"}),e.jsx("input",{type:"text",value:r.partNumber,onChange:m=>l({...r,partNumber:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Введите артикул (опционально)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Количество *"}),e.jsx("input",{type:"number",value:r.quantity,onChange:m=>l({...r,quantity:Number(m.target.value)}),min:"1",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 border-b pb-2",children:"⚙️ Параметры"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Статус"}),e.jsxs("select",{value:r.status,onChange:m=>l({...r,status:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"draft",children:"📝 Черновик"}),e.jsx("option",{value:"active",children:"✅ Активная"}),e.jsx("option",{value:"archived",children:"📁 Архив"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Приоритет"}),e.jsxs("select",{value:r.priority,onChange:m=>l({...r,priority:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"low",children:"🟢 Низкий"}),e.jsx("option",{value:"medium",children:"🟡 Средний"}),e.jsx("option",{value:"high",children:"🟠 Высокий"}),e.jsx("option",{value:"urgent",children:"🔴 Срочный"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Плановая дата завершения"}),e.jsx("input",{type:"date",value:r.plannedEndDate,onChange:m=>l({...r,plannedEndDate:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PDF файл техкарты"}),s&&(t==null?void 0:t.pdfUrl)&&e.jsx("div",{className:"mb-2 p-2 bg-green-50 border border-green-200 rounded text-sm text-green-700",children:"📄 Текущий PDF файл загружен"}),e.jsx("input",{type:"file",accept:".pdf",onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),r.file&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["✅ Выбран файл: ",r.file.name]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Максимальный размер: 10MB. Только PDF файлы."})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 border-b pb-2",children:"📄 Дополнительная информация"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Описание"}),e.jsx("textarea",{value:r.description,onChange:m=>l({...r,description:m.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Краткое описание изделия и технологических особенностей..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Заметки"}),e.jsx("textarea",{value:r.notes,onChange:m=>l({...r,notes:m.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Дополнительные заметки, требования, особенности производства..."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:a,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Отменить"}),e.jsx("button",{type:"submit",disabled:o,className:"px-8 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o?s?"⏳ Сохранение...":"⏳ Создание...":s?"💾 Сохранить":"✨ Создать"})]})]})]})})},ct=({techCard:t,onClose:s,onEdit:a})=>{const{user:n}=R(),[r,l]=i.useState(t),[o,d]=i.useState(!1),[c,u]=i.useState(!1),[m,g]=i.useState({quantityProduced:"",setupNumber:1}),h=(n==null?void 0:n.role)==="master"||(n==null?void 0:n.role)==="admin",p=["master","admin","employee"].includes((n==null?void 0:n.role)||"");i.useEffect(()=>{(async()=>{try{d(!0);const S=await Oe(t.id.toString());l(S)}catch(S){console.error("Error loading detailed tech card:",S)}finally{d(!1)}})()},[t.id]);const y=async C=>{if(C.preventDefault(),!m.quantityProduced||parseInt(m.quantityProduced)<1){alert("Укажите корректное количество произведенных деталей");return}try{const S={quantityProduced:parseInt(m.quantityProduced),setupNumber:m.setupNumber};await jr(r.id.toString(),S);const A=await Oe(r.id.toString());l(A),g({quantityProduced:"",setupNumber:1}),u(!1)}catch(S){alert("Ошибка при добавлении выполнения"),console.error("Error adding execution:",S)}},b=C=>{switch(C){case"draft":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"active":return"bg-green-100 text-green-800 border-green-200";case"archived":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},j=C=>{switch(C){case"draft":return"📝 Черновик";case"active":return"✅ Активная";case"archived":return"📁 Архив";default:return C}},N=C=>({low:"🟢 Низкий",medium:"🟡 Средний",high:"🟠 Высокий",urgent:"🔴 Срочный"})[C]||C,x=Pe(r),f=r.quantity-r.totalProducedQuantity,v=ne(r),w=Ee(r);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:r.productName}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full border ${b(r.status)}`,children:j(r.status)}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded",style:{backgroundColor:`${Y(r.priority)}20`,color:Y(r.priority),border:`1px solid ${Y(r.priority)}40`},children:N(r.priority)}),r.partNumber&&e.jsxs("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:["🏷️ ",r.partNumber]}),v&&e.jsx("span",{className:"px-2 py-1 text-xs bg-red-100 text-red-800 rounded font-medium",children:"⚠️ Просрочено"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a&&h&&e.jsx("button",{onClick:a,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors",children:"✏️ Редактировать"}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"Закрыть"})]})]}),o?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"}),e.jsx("span",{className:"text-gray-600",children:"Загрузка данных..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-indigo-900 border-b border-indigo-100 pb-2",children:"📋 Информация о заказе"}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"🏢 Заказчик:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:r.customer})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"📋 Номер заказа:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:r.order})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"🔧 Изделие:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:r.productName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"📊 План выпуска:"}),e.jsxs("p",{className:"text-gray-900 font-medium",children:[r.quantity," шт"]})]})]}),(r.plannedEndDate||r.actualEndDate)&&e.jsx("div",{className:"pt-2 border-t border-indigo-100",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.plannedEndDate&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"📅 Плановая дата:"}),e.jsxs("p",{className:"text-gray-900",children:[new Date(r.plannedEndDate).toLocaleDateString("ru-RU"),w!==null&&!r.actualEndDate&&e.jsxs("span",{className:`ml-2 text-xs ${w<0?"text-red-600":w<3?"text-orange-600":"text-green-600"}`,children:["(",w<0?`просрочено на ${Math.abs(w)} дн.`:`${w} дн.`,")"]})]})]}),r.actualEndDate&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"✅ Факт. дата:"}),e.jsx("p",{className:"text-gray-900",children:new Date(r.actualEndDate).toLocaleDateString("ru-RU")})]})]})}),r.description&&e.jsxs("div",{className:"pt-2 border-t border-indigo-100",children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"📄 Описание:"}),e.jsx("p",{className:"text-gray-900 mt-1",children:r.description})]}),r.notes&&e.jsxs("div",{className:"pt-2 border-t border-indigo-100",children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"📝 Заметки:"}),e.jsx("p",{className:"text-gray-900 mt-1 whitespace-pre-line",children:r.notes})]}),r.creator&&e.jsxs("div",{className:"pt-2 border-t border-indigo-100",children:[e.jsx("label",{className:"text-sm font-medium text-indigo-600",children:"👤 Создал:"}),e.jsxs("p",{className:"text-gray-900",children:[r.creator.firstName," ",r.creator.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(r.createdAt).toLocaleDateString("ru-RU")})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-green-900 border-b border-green-100 pb-2",children:"📊 Прогресс выполнения"}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-green-700",children:"Выполнено"}),e.jsxs("span",{className:"text-lg font-bold text-green-900",children:[r.totalProducedQuantity," из ",r.quantity,e.jsxs("span",{className:"text-sm font-normal ml-2",children:["(",x,"%)"]})]})]}),e.jsx("div",{className:"w-full bg-green-200 rounded-full h-4 mb-3",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-4 rounded-full transition-all duration-500 ease-out flex items-center justify-end pr-2",style:{width:`${Math.min(x,100)}%`},children:x>10&&e.jsxs("span",{className:"text-xs font-bold text-white",children:[x,"%"]})})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:r.totalProducedQuantity}),e.jsx("p",{className:"text-xs text-green-600",children:"Произведено"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-orange-600",children:f}),e.jsx("p",{className:"text-xs text-orange-600",children:"Остается"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-900 border-b border-purple-100 pb-2",children:"📄 Техкарта и чертеж"}),r.pdfUrl?e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 rounded-lg p-6 h-80 flex flex-col items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📄"}),e.jsx("p",{className:"text-gray-700 mb-2",children:"PDF файл с техкартой и чертежом"}),r.pdfFileSize&&e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:vr(r.pdfFileSize)}),e.jsxs("button",{onClick:()=>{if(!r.pdfUrl){console.error("PDF URL is not available");return}const C=fr(r.pdfUrl);console.log("Opening PDF:",C),window.open(C,"_blank","noopener,noreferrer")},className:"inline-flex items-center px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium",children:[e.jsx("span",{children:"📖 Открыть PDF файл"}),e.jsx("svg",{className:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Откроется в новой вкладке"})]})}):e.jsx("div",{className:"bg-gray-100 rounded-lg p-6 h-80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl text-gray-400 mb-4",children:"📄"}),e.jsx("p",{className:"text-gray-500",children:"PDF файл не загружен"}),h&&e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:'Используйте кнопку "Редактировать" для загрузки файла'})]})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-900 border-b border-orange-100 pb-1",children:"⚡ Фиксация работы"}),p&&r.status==="active"&&e.jsx("button",{onClick:()=>u(!c),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium",children:"+ Зафиксировать работу"})]}),c&&e.jsxs("form",{onSubmit:y,className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg p-4 mb-6 border border-orange-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-orange-700 mb-2",children:"📊 Количество произведено *"}),e.jsx("input",{type:"number",value:m.quantityProduced,onChange:C=>g({...m,quantityProduced:C.target.value}),placeholder:"Количество деталей",className:"w-full px-3 py-2 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",required:!0,min:"1",max:f}),e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Максимум: ",f," шт (остается произвести)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-orange-700 mb-2",children:"🔧 Номер установки"}),e.jsxs("select",{value:m.setupNumber,onChange:C=>g({...m,setupNumber:parseInt(C.target.value)}),className:"w-full px-3 py-2 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:1,children:"Установка 1"}),e.jsx("option",{value:2,children:"Установка 2"}),e.jsx("option",{value:3,children:"Установка 3"}),e.jsx("option",{value:4,children:"Установка 4"})]}),e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"Выберите номер технологической установки"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"Отмена"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium",children:"✅ Зафиксировать работу"})]})]}),r.executions&&r.executions.length>0?e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900 border-b",children:"📅 Дата и время"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-900 border-b",children:"👤 Исполнитель"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900 border-b",children:"📊 Количество"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-900 border-b",children:"🔧 Установка"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:r.executions.sort((C,S)=>new Date(S.executedAt).getTime()-new Date(C.executedAt).getTime()).map((C,S)=>e.jsxs("tr",{className:S%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:new Date(C.executedAt).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:[C.executor.firstName," ",C.executor.lastName]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800",children:[C.quantityProduced," шт"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-sm font-medium bg-blue-100 text-blue-800",children:["#",C.setupNumber||1]})})]},C.id))})]})}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"text-6xl text-gray-400 mb-4",children:"📝"}),e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"Пока нет записей о выполненной работе"}),p&&r.status==="active"?e.jsx("p",{className:"text-sm text-gray-400",children:'Нажмите кнопку "Зафиксировать работу" чтобы добавить первую запись'}):e.jsx("p",{className:"text-sm text-gray-400",children:"Записи появятся после выполнения работ по данной техкарте"})]})]})]})]})})},kr=()=>{const{user:t}=R(),[s,a]=i.useState([]),[n,r]=i.useState([]),[l,o]=i.useState(!0),[d,c]=i.useState(null),[u,m]=i.useState(!1),[g,h]=i.useState(!1),[p,y]=i.useState(!1),[b,j]=i.useState(null),[N,x]=i.useState(!1),[f,v]=i.useState(""),[w,C]=i.useState("all"),[S,A]=i.useState("all"),E=(t==null?void 0:t.role)==="master"||(t==null?void 0:t.role)==="admin",F=["master","admin","employee","director"].includes((t==null?void 0:t.role)||""),B=async()=>{try{o(!0),c(null);const k=await nt();a(k),r(k)}catch(k){c("Ошибка при загрузке технологических карт"),console.error("Error loading tech cards:",k)}finally{o(!1)}};i.useEffect(()=>{F&&B()},[F]),i.useEffect(()=>{let k=s;f&&(k=k.filter(D=>D.productName.toLowerCase().includes(f.toLowerCase())||D.partNumber&&D.partNumber.toLowerCase().includes(f.toLowerCase())||D.customer.toLowerCase().includes(f.toLowerCase())||D.order.toLowerCase().includes(f.toLowerCase()))),w!=="all"&&(k=k.filter(D=>D.status===w)),S!=="all"&&(k=k.filter(D=>D.customer===S)),r(k)},[f,w,S,s]);const De=()=>Array.from(new Set(s.map(D=>D.customer))).sort(),$e=()=>{j(null),m(!0),h(!1),y(!1)},Re=k=>{j(k),h(!0),m(!1),y(!1)},dt=k=>{j(k),y(!0),m(!1),h(!1)},mt=k=>{j(k),x(!0)},ut=async()=>{if(b)try{await ot(b.id.toString()),await B(),x(!1),j(null)}catch(k){alert("Ошибка при удалении техкарты"),console.error("Error deleting tech card:",k)}},xt=async(k,D)=>{try{await it(k.id.toString(),D),await B()}catch(ht){alert("Ошибка при изменении статуса"),console.error("Error updating status:",ht)}},Le=()=>{m(!1),h(!1),j(null),B()},de=()=>{m(!1),h(!1),y(!1),x(!1),j(null)},U={total:s.length,drafts:s.filter(k=>k.status==="draft").length,active:s.filter(k=>k.status==="active").length,archived:s.filter(k=>k.status==="archived").length,totalQuantity:s.reduce((k,D)=>k+D.quantity,0),totalProduced:s.reduce((k,D)=>k+D.totalProducedQuantity,0),uniqueCustomers:De().length,withPdf:s.filter(k=>k.pdfUrl).length};return F?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 border-l-4 border-indigo-400 p-6 rounded-lg",children:[e.jsx("h1",{className:"text-3xl font-bold text-indigo-900 mb-2",children:"🔧 Технологические карты"}),e.jsx("p",{className:"text-indigo-700",children:"Упрощенное управление техкартами с PDF файлами и автоматическим отслеживанием"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-3 text-sm text-indigo-600",children:[e.jsxs("span",{children:["📊 Всего: ",U.total]}),e.jsxs("span",{children:["🏢 Заказчиков: ",U.uniqueCustomers]}),e.jsxs("span",{children:["📄 С PDF: ",U.withPdf]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"🔍 Поиск по названию, артикулу, заказчику или номеру заказа...",value:f,onChange:k=>v(k.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"})}),e.jsxs("select",{value:w,onChange:k=>C(k.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"all",children:"Все статусы"}),e.jsx("option",{value:"draft",children:"📝 Черновик"}),e.jsx("option",{value:"active",children:"✅ Активные"}),e.jsx("option",{value:"archived",children:"📁 Архив"})]}),e.jsxs("select",{value:S,onChange:k=>A(k.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"all",children:"Все заказчики"}),De().map(k=>e.jsx("option",{value:k,children:k},k))]})]}),E&&e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:$e,className:"px-6 py-2 bg-gradient-to-r from-indigo-600 to-blue-600 text-white rounded-lg hover:from-indigo-700 hover:to-blue-700 transition-all duration-200 font-medium shadow-sm",children:"➕ Создать техкарту"})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:U.total}),e.jsx("p",{className:"text-sm text-gray-600",children:"Всего техкарт"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:U.drafts}),e.jsx("p",{className:"text-sm text-yellow-600",children:"Черновики"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-700",children:U.active}),e.jsx("p",{className:"text-sm text-green-600",children:"Активные"})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-indigo-700",children:U.totalQuantity.toLocaleString()}),e.jsx("p",{className:"text-sm text-indigo-600",children:"План (шт)"})]}),e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-700",children:U.totalProduced.toLocaleString()}),e.jsx("p",{className:"text-sm text-emerald-600",children:"Произведено"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:U.uniqueCustomers}),e.jsx("p",{className:"text-sm text-blue-600",children:"Заказчиков"})]})]}),(f||w!=="all"||S!=="all")&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Активные фильтры:"}),f&&e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm",children:['Поиск: "',f,'"',e.jsx("button",{onClick:()=>v(""),className:"ml-1 text-blue-600 hover:text-blue-800",children:"×"})]}),w!=="all"&&e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded text-sm",children:["Статус: ",w,e.jsx("button",{onClick:()=>C("all"),className:"ml-1 text-green-600 hover:text-green-800",children:"×"})]}),S!=="all"&&e.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded text-sm",children:["Заказчик: ",S,e.jsx("button",{onClick:()=>A("all"),className:"ml-1 text-purple-600 hover:text-purple-800",children:"×"})]}),e.jsx("button",{onClick:()=>{v(""),C("all"),A("all")},className:"text-sm text-red-600 hover:text-red-800 underline",children:"Очистить все"})]}),l?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"}),e.jsx("span",{className:"text-gray-600",children:"Загрузка техкарт..."})]})}):d?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-red-600 mb-4",children:d}),e.jsx("button",{onClick:B,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"🔄 Повторить попытку"})]}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:f||w!=="all"||S!=="all"?"🔍":"📄"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:f||w!=="all"||S!=="all"?"Техкарты не найдены":"Пока нет технологических карт"}),e.jsx("p",{className:"text-gray-500 mb-4",children:f||w!=="all"||S!=="all"?"Попробуйте изменить параметры поиска":"Создайте первую техкарту для начала работы"}),E&&!f&&w==="all"&&S==="all"&&e.jsx("button",{onClick:$e,className:"px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium",children:"➕ Создать первую техкарту"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Показано ",n.length," из ",s.length," техкарт"]}),n.length!==s.length&&e.jsx("p",{className:"text-sm text-gray-500",children:"Применены фильтры"})]}),e.jsx(wr,{techCards:n,onView:dt,onEdit:E?Re:void 0,onDelete:E?mt:void 0,onStatusChange:E?xt:void 0})]})]}),u&&e.jsx(fe,{onSuccess:Le,onClose:de}),g&&b&&e.jsx(fe,{techCard:b,onSuccess:Le,onClose:de}),p&&b&&e.jsx(ct,{techCard:b,onClose:de,onEdit:E?()=>Re(b):void 0}),N&&b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"text-red-500 text-3xl",children:"⚠️"}),e.jsx("h3",{className:"text-lg font-bold text-red-600",children:"Подтверждение удаления"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-700 mb-4",children:"Вы действительно хотите удалить техкарту?"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"font-medium text-gray-900",children:b.productName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Заказчик: ",b.customer]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Заказ: ",b.order]}),b.partNumber&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Артикул: ",b.partNumber]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-700 text-sm font-medium",children:"⚠️ Это действие нельзя отменить!"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:"Все связанные данные (выполнения, история доступов) также будут удалены."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Отменить"}),e.jsx("button",{onClick:ut,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Удалить техкарту"})]})]})})})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl text-gray-400 mb-4",children:"🚫"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"Доступ запрещён"}),e.jsx("p",{className:"text-gray-500",children:"У вас нет прав для просмотра технологических карт"})]})})},Cr=()=>e.jsx("div",{children:"Administrative Department Content"}),Sr=()=>e.jsx("div",{children:"Commercial Department Content"}),Pr=()=>e.jsxs("div",{children:[e.jsx("h2",{children:"Финансовый отдел"}),e.jsx("p",{children:"Добро пожаловать в портал Финансового департамента."}),e.jsxs("ul",{children:[e.jsx("li",{children:"Отчёты о доходах и расходах"}),e.jsx("li",{children:"Контроль бюджета"}),e.jsx("li",{children:"Финансовое планирование"})]})]}),Er=()=>e.jsx("div",{children:"Human Resources Department Content"}),Dr=({tasks:t})=>e.jsxs("div",{children:[e.jsx("h2",{children:"Производственные задачи"}),t.map(s=>e.jsx("div",{children:s.title},s.id))]}),$r=({reports:t})=>e.jsxs("div",{children:[e.jsx("h2",{children:"Отчёты"}),t.map(s=>e.jsx("div",{children:s.title},s.id))]}),Rr=({equipment:t})=>e.jsxs("div",{children:[e.jsx("h2",{children:"Состояние оборудования"}),t.map(s=>e.jsxs("div",{children:[s.name," - ",s.status]},s.id))]}),Lr=()=>{const[t,s]=i.useState("tasks"),{data:a,isLoading:n,error:r}=jt({queryKey:["productionData"],queryFn:async()=>({tasks:[{id:1,title:"Контроль качества",status:"В работе"}],reports:[{id:1,title:"Ежедневный отчёт"}],equipment:[{id:1,name:"Печь",status:"Работает"}]}),staleTime:60*1e3});return n?e.jsx("div",{className:"p-4 text-center",children:"Загрузка данных..."}):r?e.jsx("div",{className:"p-4 text-center text-red-500",children:"Ошибка загрузки данных"}):e.jsxs("div",{className:"production-department p-4",children:[e.jsxs("div",{className:"tabs mb-6 flex border-b border-gray-200",children:[e.jsx("button",{onClick:()=>s("tasks"),className:`px-4 py-2 font-medium text-sm rounded-t-lg ${t==="tasks"?"bg-blue-50 text-blue-600 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:"Производственные задачи"}),e.jsx("button",{onClick:()=>s("reports"),className:`px-4 py-2 font-medium text-sm rounded-t-lg ${t==="reports"?"bg-blue-50 text-blue-600 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:"Отчёты"}),e.jsx("button",{onClick:()=>s("equipment"),className:`px-4 py-2 font-medium text-sm rounded-t-lg ${t==="equipment"?"bg-blue-50 text-blue-600 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:"Состояние оборудования"})]}),e.jsxs("div",{className:"content-area",children:[t==="tasks"&&e.jsx(Dr,{tasks:(a==null?void 0:a.tasks)||[]}),t==="reports"&&e.jsx($r,{reports:(a==null?void 0:a.reports)||[]}),t==="equipment"&&e.jsx(Rr,{equipment:(a==null?void 0:a.equipment)||[]})]})]})},Tr=()=>e.jsx("div",{children:"Quality Department Content"}),Ir=()=>{var r,l;const{departmentId:t}=es(),{user:s}=R();if(!s||((r=s.department)==null?void 0:r.id.toString())!==t&&s.role!=="admin")return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Доступ запрещен"}),e.jsx("p",{children:"У вас нет прав для просмотра этого департамента."})]});const n={1:Cr,2:Sr,3:Pr,4:Er,5:Lr,6:Tr}[t||""];return n?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["Портал департамента: ",(l=s.department)==null?void 0:l.name]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Добро пожаловать, ",s.firstName," ",s.lastName]})]}),e.jsx(n,{})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-600 mb-4",children:"Департамент не найден"}),e.jsxs("p",{children:["Департамент с ID ",t," не существует."]})]})},Ar=({users:t,onUserDeleted:s})=>{const a=async r=>{if(confirm("Вы уверены, что хотите удалить этого пользователя?"))try{const l=localStorage.getItem("token");(await fetch(`/api/users/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}})).ok?s():alert("Ошибка удаления пользователя")}catch(l){console.error("Ошибка удаления пользователя:",l),alert("Ошибка соединения с сервером")}},n=async(r,l)=>{try{const o=localStorage.getItem("token");(await fetch(`/api/users/${r}/role`,{method:"PATCH",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({role:l})})).ok?s():alert("Ошибка изменения роли")}catch(o){console.error("Ошибка изменения роли:",o),alert("Ошибка соединения с сервером")}};return t.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Пользователи не найдены"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Пользователь"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Логин"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Роль"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Департамент"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Телефон"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:t.map(r=>{var l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[r.firstName," ",r.lastName]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:r.username})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:r.role,onChange:o=>n(r.id,o.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"employee",children:"Сотрудник"}),e.jsx("option",{value:"master",children:"Мастер"}),e.jsx("option",{value:"director",children:"Директор"}),e.jsx("option",{value:"admin",children:"Администратор"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:((l=r.department)==null?void 0:l.name)||"Не указан"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:r.phone||"Не указан"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>a(r.id),className:"text-red-600 hover:text-red-900",children:"Удалить"})})]},r.id)})})]})})},Fr=({onUserCreated:t})=>{const[s,a]=i.useState({username:"",password:"",firstName:"",lastName:"",role:"employee",phone:"",departmentId:""}),[n,r]=i.useState([]),[l,o]=i.useState(!1),[d,c]=i.useState("");i.useEffect(()=>{u()},[]);const u=async()=>{try{const h=localStorage.getItem("token"),p=await fetch("/api/departments",{headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});if(p.ok){const y=await p.json();r(y)}}catch(h){console.error("Ошибка загрузки департаментов:",h)}},m=async h=>{h.preventDefault(),o(!0),c("");try{const p=localStorage.getItem("token"),y=await fetch("/api/users/register",{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({...s,departmentId:parseInt(s.departmentId)})});if(y.ok)t(),a({username:"",password:"",firstName:"",lastName:"",role:"employee",phone:"",departmentId:""});else{const b=await y.json();c(b.message||"Ошибка создания пользователя")}}catch{c("Ошибка соединения с сервером")}finally{o(!1)}},g=h=>{a({...s,[h.target.name]:h.target.value})};return e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Логин"}),e.jsx("input",{type:"text",name:"username",value:s.username,onChange:g,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Пароль"}),e.jsx("input",{type:"password",name:"password",value:s.password,onChange:g,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Имя"}),e.jsx("input",{type:"text",name:"firstName",value:s.firstName,onChange:g,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Фамилия"}),e.jsx("input",{type:"text",name:"lastName",value:s.lastName,onChange:g,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Роль"}),e.jsxs("select",{name:"role",value:s.role,onChange:g,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"employee",children:"Сотрудник"}),e.jsx("option",{value:"master",children:"Мастер"}),e.jsx("option",{value:"director",children:"Директор"}),e.jsx("option",{value:"admin",children:"Администратор"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Департамент"}),e.jsxs("select",{name:"departmentId",value:s.departmentId,onChange:g,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Выберите департамент"}),n.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Телефон"}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:g,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]}),d&&e.jsx("div",{className:"text-red-600 text-sm",children:d}),e.jsx("button",{type:"submit",disabled:l,className:`w-full py-2 px-4 rounded-md text-white font-medium ${l?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:l?"Создание...":"Создать пользователя"})]})},Ur=({onClose:t})=>{const[s,a]=i.useState([]),[n,r]=i.useState(!0),[l,o]=i.useState(!1),[d,c]=i.useState(null);i.useEffect(()=>{u()},[]);const u=async()=>{try{const p=localStorage.getItem("token"),y=await fetch("/api/productionPlans",{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}});if(y.ok){const b=await y.json();a(b)}}catch(p){console.error("Ошибка загрузки планов:",p)}finally{r(!1)}},m=async p=>{if(confirm("Вы уверены, что хотите удалить этот план?"))try{const y=localStorage.getItem("token");(await fetch(`/api/productionPlans/${p}`,{method:"DELETE",headers:{Authorization:`Bearer ${y}`,"Content-Type":"application/json"}})).ok?u():alert("Ошибка удаления плана")}catch(y){console.error("Ошибка удаления:",y),alert("Ошибка соединения")}},g=p=>new Date(p).toLocaleDateString("ru-RU"),h=p=>p>=80?"bg-green-500":p>=50?"bg-yellow-500":p>=20?"bg-orange-500":"bg-red-500";return n?e.jsx("div",{className:"text-center py-4",children:"Загрузка планов производства..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"📋 Управление планами производства"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>o(!l),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:l?"Отменить":"+ Создать план"}),t&&e.jsx("button",{onClick:t,className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Закрыть"})]})]}),(l||d)&&e.jsx(qr,{plan:d,onSaved:()=>{o(!1),c(null),u()},onCancel:()=>{o(!1),c(null)}}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Заказ"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Заказчик"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Количество"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Срок"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Прогресс"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(p=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:p.orderName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:p.customerName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[p.quantity," шт."]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:g(p.deadline)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${h(p.progressPercent)}`,style:{width:`${p.progressPercent}%`}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[p.progressPercent,"%"]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>c(p),className:"text-blue-600 hover:text-blue-900",children:"Изменить"}),e.jsx("button",{onClick:()=>m(p.id),className:"text-red-600 hover:text-red-900",children:"Удалить"})]})]},p.id))})]})}),s.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Планы производства не найдены"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.length}),e.jsx("div",{className:"text-sm text-blue-800",children:"Всего планов"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.filter(p=>p.progressPercent>=80).length}),e.jsx("div",{className:"text-sm text-green-800",children:"Почти готово"})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:s.filter(p=>p.progressPercent>0&&p.progressPercent<80).length}),e.jsx("div",{className:"text-sm text-yellow-800",children:"В работе"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:s.filter(p=>p.progressPercent===0).length}),e.jsx("div",{className:"text-sm text-red-800",children:"Не начато"})]})]})]})},qr=({plan:t,onSaved:s,onCancel:a})=>{var m,g;const[n,r]=i.useState({orderName:(t==null?void 0:t.orderName)||"",customerName:(t==null?void 0:t.customerName)||"",quantity:((m=t==null?void 0:t.quantity)==null?void 0:m.toString())||"",deadline:t!=null&&t.deadline?t.deadline.split("T")[0]:"",progressPercent:((g=t==null?void 0:t.progressPercent)==null?void 0:g.toString())||"0"}),[l,o]=i.useState(!1),[d,c]=i.useState(""),u=async h=>{h.preventDefault(),o(!0),c("");try{const p=localStorage.getItem("token"),y=t?`/api/productionPlans/${t.id}`:"/api/productionPlans",j=await fetch(y,{method:t?"PUT":"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({...n,quantity:parseInt(n.quantity),progressPercent:parseInt(n.progressPercent)})});if(j.ok)s();else{const N=await j.json();c(N.error||"Ошибка сохранения")}}catch{c("Ошибка соединения с сервером")}finally{o(!1)}};return e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-medium mb-4",children:t?"Редактировать план":"Создать новый план"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Номер заказа"}),e.jsx("input",{type:"text",value:n.orderName,onChange:h=>r({...n,orderName:h.target.value}),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Например: MS-2025-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Заказчик"}),e.jsx("input",{type:"text",value:n.customerName,onChange:h=>r({...n,customerName:h.target.value}),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Название компании"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Количество"}),e.jsx("input",{type:"number",min:"1",value:n.quantity,onChange:h=>r({...n,quantity:h.target.value}),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Срок выполнения"}),e.jsx("input",{type:"date",value:n.deadline,onChange:h=>r({...n,deadline:h.target.value}),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Прогресс (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:n.progressPercent,onChange:h=>r({...n,progressPercent:h.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]})]}),d&&e.jsx("div",{className:"text-red-600 text-sm",children:d}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"submit",disabled:l,className:`px-4 py-2 rounded text-white font-medium ${l?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:l?"Сохранение...":"Сохранить"}),e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 rounded bg-gray-300 text-gray-700 hover:bg-gray-400",children:"Отменить"})]})]})]})},Mr=()=>{const[t,s]=i.useState([]),[a,n]=i.useState(!0),[r,l]=i.useState(!1),[o,d]=i.useState(void 0),[c,u]=i.useState(void 0),[m,g]=i.useState(""),[h,p]=i.useState("all");i.useEffect(()=>{y()},[]);const y=async()=>{try{n(!0);const f=await nt();s(f)}catch(f){console.error("Ошибка загрузки техкарт:",f)}finally{n(!1)}},b=async f=>{if(window.confirm("Вы уверены, что хотите удалить эту техкарту?"))try{await ot(f.toString()),s(v=>v.filter(w=>w.id!==f))}catch(v){alert("Ошибка при удалении техкарты"),console.error("Error deleting tech card:",v)}},j=async(f,v)=>{try{await it(f.id.toString(),v),s(w=>w.map(C=>C.id===f.id?{...C,status:v}:C))}catch(w){alert("Ошибка при изменении статуса"),console.error("Error updating status:",w)}},N=()=>{l(!1),d(void 0),y()},x=t.filter(f=>{const v=m===""||f.productName.toLowerCase().includes(m.toLowerCase())||f.customer.toLowerCase().includes(m.toLowerCase())||f.order.toLowerCase().includes(m.toLowerCase()),w=h==="all"||f.status===h;return v&&w});return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Загрузка техкарт..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Управление техкартами"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Администрирование всех техкарт системы"})]}),e.jsx("button",{onClick:()=>l(!0),className:"bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 font-medium",children:"+ Создать техкарту"})]}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Поиск"}),e.jsx("input",{type:"text",value:m,onChange:f=>g(f.target.value),placeholder:"Название, заказчик, заказ...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Статус"}),e.jsxs("select",{value:h,onChange:f=>p(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"Все статусы"}),e.jsx("option",{value:"draft",children:"Черновик"}),e.jsx("option",{value:"active",children:"Активная"}),e.jsx("option",{value:"archived",children:"Архив"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{g(""),p("all")},className:"w-full px-3 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Сбросить"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.length}),e.jsx("div",{className:"text-sm text-blue-600",children:"Всего техкарт"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.filter(f=>f.status==="active").length}),e.jsx("div",{className:"text-sm text-green-600",children:"Активных"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 border",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:t.filter(f=>f.status==="draft").length}),e.jsx("div",{className:"text-sm text-yellow-600",children:"Черновиков"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 border",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.filter(f=>ne(f)).length}),e.jsx("div",{className:"text-sm text-red-600",children:"Просроченных"})]})]}),e.jsx("div",{className:"bg-white rounded-lg border overflow-hidden",children:x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📄"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Техкарты не найдены"}),e.jsx("p",{className:"text-gray-500",children:"Попробуйте изменить фильтры или создать новую техкарту"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Продукт"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Заказчик"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Статус"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Прогресс"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Действия"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:x.map(f=>{const v=Pe(f),w=ne(f);return Ee(f),e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900",children:["#",f.id]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.productName}),f.partNumber&&e.jsxs("div",{className:"text-sm text-gray-500",children:["🏷️ ",f.partNumber]})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:f.customer}),e.jsx("div",{className:"text-sm text-gray-500",children:f.order})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("select",{value:f.status,onChange:C=>j(f,C.target.value),className:"text-xs px-2 py-1 rounded border",children:[e.jsx("option",{value:"draft",children:"📝 Черновик"}),e.jsx("option",{value:"active",children:"✅ Активная"}),e.jsx("option",{value:"archived",children:"📁 Архив"})]}),w&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:"⚠️ Просрочено"})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"text-sm",children:[f.totalProducedQuantity," / ",f.quantity]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${Math.min(v,100)}%`}})})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>u(f),className:"text-indigo-600 hover:text-indigo-900 text-sm",children:"👁️ Просмотр"}),e.jsx("button",{onClick:()=>d(f),className:"text-blue-600 hover:text-blue-900 text-sm",children:"✏️ Изменить"}),e.jsx("button",{onClick:()=>b(f.id),className:"text-red-600 hover:text-red-900 text-sm",children:"🗑️ Удалить"})]})})]},f.id)})})]})}),(r||o)&&e.jsx(fe,{techCard:o,onClose:N,isEdit:!!o}),c&&e.jsx(ct,{techCard:c,onClose:()=>u(void 0),onEdit:()=>{d(c),u(void 0)}})]})},Or=()=>{const{user:t,loading:s}=R(),[a,n]=i.useState([]),[r,l]=i.useState(!1),[o,d]=i.useState(!0),[c,u]=i.useState("users");if(!t||t.role!=="admin")return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Доступ запрещен"}),e.jsx("p",{children:"У вас нет прав администратора."})]});i.useEffect(()=>{m()},[]);const m=async()=>{try{const p=localStorage.getItem("token");if(!p)return;const y=await fetch("/api/users",{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}});if(y.ok){const b=await y.json();n(b)}else console.error("Ошибка загрузки пользователей:",y.status)}catch(p){console.error("Ошибка запроса пользователей:",p)}finally{d(!1)}},g=()=>{l(!1),m()},h=()=>{m()};return s||o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Загрузка админ-панели..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-900",children:"🔧 Панель администратора"}),e.jsxs("p",{className:"text-red-700 mt-1",children:["Добро пожаловать, ",t.firstName," ",t.lastName]})]})})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsx("button",{onClick:()=>u("users"),className:`px-4 py-2 rounded ${c==="users"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"👥 Пользователи"}),e.jsx("button",{onClick:()=>u("plans"),className:`px-4 py-2 rounded ${c==="plans"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"📋 Планы производства"}),e.jsx("button",{onClick:()=>u("techcards"),className:`px-4 py-2 rounded ${c==="techcards"?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"📄 Техкарты"})]}),c==="users"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Управление пользователями"}),e.jsx("button",{onClick:()=>l(!r),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:r?"Отменить":"+ Создать пользователя"})]}),r&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded",children:e.jsx(Fr,{onUserCreated:g})}),e.jsx(Ar,{users:a,onUserDeleted:h})]}),c==="plans"&&e.jsx(Ur,{}),c==="techcards"&&e.jsx(Mr,{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"📊 Статистика"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Общая статистика системы"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[a.length," пользователей"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"⚙️ Настройки"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Системные настройки"}),e.jsx("button",{className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",children:"Открыть настройки"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"📝 Логи"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Системные логи и аудит"}),e.jsx("button",{className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:"Просмотреть логи"})]})]})]})},Br=({children:t})=>{const{user:s,loading:a}=R();return a?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Загрузка..."}):s?e.jsx(e.Fragment,{children:t}):e.jsx(pe,{to:"/login",replace:!0})},Hr=()=>{const{user:t,loading:s}=R(),a=Z();return i.useEffect(()=>{if(!s&&t){if(console.log("🎯 Автоматическое перенаправление для пользователя:",t),t.role==="admin"){console.log("👨‍💼 Перенаправление админа в админ-панель"),a("/admin",{replace:!0});return}if(t.department){console.log("🏢 Перенаправление в портал департамента:",t.department.name),a(`/departments/${t.department.id}`,{replace:!0});return}console.log("🏠 Перенаправление на главную страницу (fallback)"),a("/",{replace:!0})}},[t,s,a]),s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Перенаправление..."})}):null},ie="/api/assignments",Wr=()=>localStorage.getItem("token"),ce=()=>{const t=Wr();return{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}}},zr=async()=>{try{const t=await fetch(ie,{method:"GET",headers:ce()});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return{data:await t.json()}}catch(t){throw console.error("Ошибка загрузки заданий:",t),t}},Qr=async t=>{try{const s=await fetch(ie,{method:"POST",headers:ce(),body:JSON.stringify(t)});if(!s.ok){const a=await s.json().catch(()=>({message:"Ошибка сервера"}));throw new Error(a.message||`HTTP error! status: ${s.status}`)}return await s.json()}catch(s){throw console.error("Ошибка создания задания:",s),s}},Be=async(t,s)=>{try{const a=await fetch(`${ie}/${t}`,{method:"PUT",headers:ce(),body:JSON.stringify(s)});if(!a.ok){const n=await a.json().catch(()=>({message:"Ошибка сервера"}));throw new Error(n.message||`HTTP error! status: ${a.status}`)}return await a.json()}catch(a){throw console.error("Ошибка обновления задания:",a),a}},Vr=async t=>{try{const s=await fetch(`${ie}/${t}`,{method:"DELETE",headers:ce()});if(!s.ok){const a=await s.json().catch(()=>({message:"Ошибка сервера"}));throw new Error(a.message||`HTTP error! status: ${s.status}`)}return await s.json()}catch(s){throw console.error("Ошибка удаления задания:",s),s}},_r=({userRole:t})=>{const[s,a]=i.useState([]),[n,r]=i.useState(!0),[l,o]=i.useState(null),[d,c]=i.useState(new Set),{user:u}=R(),m=t==="master"||t==="admin";i.useEffect(()=>{g()},[]);const g=async()=>{try{r(!0),o(null);const x=await zr();console.log("📦 Ответ от API fetchAssignments:",x),x&&typeof x=="object"?x.data&&Array.isArray(x.data)?(a(x.data),console.log("✅ Загружено заданий из response.data:",x.data.length)):Array.isArray(x)?(a(x),console.log("✅ Загружено заданий из response:",x.length)):(console.warn("⚠️ API вернул неожиданный формат:",x),a([])):(console.warn("⚠️ API вернул пустой или некорректный ответ"),a([]))}catch(x){console.error("❌ Ошибка загрузки заданий:",x),o("Не удалось загрузить задания. Проверьте подключение к серверу."),a([])}finally{r(!1)}},h=async(x,f)=>{if(!d.has(x)){c(v=>new Set(v).add(x));try{await Be(x,{status:f}),a(v=>v.map(w=>w.id===x?{...w,status:f}:w))}catch(v){console.error("Ошибка обновления статуса:",v),alert("Ошибка при обновлении статуса задания")}finally{c(v=>{const w=new Set(v);return w.delete(x),w})}}},p=async(x,f)=>{if(!d.has(x)){c(v=>new Set(v).add(x));try{await Be(x,{actualQuantity:f}),a(v=>v.map(w=>w.id===x?{...w,actualQuantity:f}:w))}catch(v){console.error("Ошибка обновления количества:",v),alert("Ошибка при обновлении количества")}finally{c(v=>{const w=new Set(v);return w.delete(x),w})}}},y=async x=>{if(m&&confirm("Вы уверены, что хотите удалить это задание?"))try{await Vr(x),a(f=>f.filter(v=>v.id!==x))}catch(f){console.error("Ошибка удаления задания:",f),alert("Ошибка при удалении задания")}},b=x=>new Date(x).toLocaleDateString("ru-RU"),j=x=>{switch(x){case"completed":return"bg-green-100 text-green-800";case"assigned":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},N=x=>x==="day"?"Дневная":"Ночная";return n?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mr-3"}),e.jsx("div",{className:"text-lg",children:"Загрузка заданий..."})]}):l?e.jsxs("div",{className:"text-center p-8",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:["❌ ",l]}),e.jsx("button",{onClick:g,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:"🔄 Попробовать снова"})]}):Array.isArray(s)?s.length===0?e.jsxs("div",{className:"text-center p-8 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📋"}),e.jsx("div",{className:"text-xl mb-2",children:"Задания не найдены"}),e.jsx("p",{className:"text-sm mt-2",children:m?"Создайте первое задание, нажав кнопку выше":"У вас пока нет назначенных заданий"}),e.jsx("button",{onClick:g,className:"mt-4 text-blue-600 hover:text-blue-800 text-sm",children:"🔄 Обновить список"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4 flex justify-between items-center",children:[e.jsxs("span",{children:["Найдено заданий: ",e.jsx("span",{className:"font-semibold",children:s.length})]}),e.jsx("button",{onClick:g,className:"text-blue-600 hover:text-blue-800 text-xs",disabled:n,children:"🔄 Обновить"})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Задача"}),m&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Оператор"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Смена"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Машина"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Количество"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Статус"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Действия"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:s.map(x=>{var f;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:x.detailName||"Не указано"}),e.jsx("div",{className:"text-sm text-gray-600",children:x.taskDescription}),x.customerName&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["Заказчик: ",x.customerName]}),x.techCardId&&e.jsx("div",{className:"mt-2",children:e.jsxs(z,{to:`/techcards/${x.techCardId}`,className:"text-blue-600 hover:text-blue-800 text-xs font-medium inline-flex items-center",children:["🔧 Техкарта: ",((f=x.techCard)==null?void 0:f.productName)||"Просмотреть"]})})]}),m&&e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.operator?`${x.operator.firstName} ${x.operator.lastName}`:`ID: ${x.operatorId}`})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:b(x.shiftDate)}),e.jsx("div",{className:"text-xs text-gray-500",children:N(x.shiftType)})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm font-mono text-gray-900",children:x.machineNumber})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:["План: ",e.jsx("span",{className:"font-semibold",children:x.plannedQuantity})]}),x.status==="completed"&&x.actualQuantity!==null?e.jsxs("div",{className:"text-sm text-green-600",children:["Факт: ",e.jsx("span",{className:"font-semibold",children:x.actualQuantity})]}):(u==null?void 0:u.id)===x.operatorId&&e.jsx("input",{type:"number",min:"0",placeholder:"Факт",className:"mt-1 w-20 px-2 py-1 text-xs border border-gray-300 rounded",onBlur:v=>{const w=parseInt(v.target.value);w>=0&&p(x.id,w)},disabled:d.has(x.id)})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${j(x.status)}`,children:x.status==="assigned"?"Назначено":"Выполнено"})}),e.jsx("td",{className:"px-4 py-4 text-sm",children:e.jsxs("div",{className:"space-x-2",children:[(u==null?void 0:u.id)===x.operatorId&&x.status==="assigned"&&e.jsx("button",{onClick:()=>h(x.id,"completed"),disabled:d.has(x.id),className:"text-green-600 hover:text-green-900 disabled:opacity-50",children:d.has(x.id)?"⏳":"✅ Выполнить"}),m&&e.jsx("button",{onClick:()=>y(x.id),className:"text-red-600 hover:text-red-900",children:"🗑️ Удалить"})]})})]},x.id)})})]})})}),e.jsx("div",{className:"lg:hidden space-y-4",children:s.map(x=>{var f;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"font-medium text-gray-900",children:x.detailName||"Задание"}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${j(x.status)}`,children:x.status==="assigned"?"Назначено":"Выполнено"})]}),e.jsx("div",{className:"text-sm text-gray-600 mb-3",children:x.taskDescription}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Смена:"})," ",b(x.shiftDate)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Тип:"})," ",N(x.shiftType)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Машина:"})," ",x.machineNumber]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"План:"})," ",x.plannedQuantity]})]}),x.customerName&&e.jsxs("div",{className:"text-xs text-blue-600 mb-2",children:["Заказчик: ",x.customerName]}),x.techCardId&&e.jsx("div",{className:"mb-3",children:e.jsxs(z,{to:`/techcards/${x.techCardId}`,className:"text-blue-600 hover:text-blue-800 text-sm font-medium inline-flex items-center",children:["🔧 Техкарта: ",((f=x.techCard)==null?void 0:f.productName)||"Просмотреть"]})}),(u==null?void 0:u.id)===x.operatorId&&x.status==="assigned"&&e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{onClick:()=>h(x.id,"completed"),disabled:d.has(x.id),className:"flex-1 bg-green-600 text-white px-3 py-2 rounded text-sm hover:bg-green-700 disabled:opacity-50",children:d.has(x.id)?"⏳ Обновление...":"✅ Отметить выполненным"})})]},x.id)})})]}):(console.error("❌ assignments не является массивом:",s),e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"text-red-600 mb-4",children:"Ошибка отображения заданий"}),e.jsx("button",{onClick:g,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"🔄 Перезагрузить"})]}))},Jr=({onAssignmentCreated:t})=>{const[s,a]=i.useState({taskDescription:"",operatorId:"",machineNumber:"",shiftDate:new Date().toISOString().split("T")[0],shiftType:"day",detailName:"",customerName:"",plannedQuantity:"",techCardId:""}),[n,r]=i.useState([]),[l,o]=i.useState([]),[d,c]=i.useState(!1),[u,m]=i.useState("");i.useEffect(()=>{g(),h()},[]);const g=async()=>{try{const b=localStorage.getItem("token"),j=await fetch("/api/users",{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}});if(j.ok){const x=(await j.json()).filter(f=>f.role==="employee"||f.role==="operator");r(x)}}catch(b){console.error("Ошибка загрузки операторов:",b)}},h=async()=>{try{const b=localStorage.getItem("token"),j=await fetch("/api/techcards",{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}});if(j.ok){const x=(await j.json()).filter(f=>f.status==="active");o(x)}}catch(b){console.error("Ошибка загрузки технологических карт:",b)}},p=async b=>{if(b.preventDefault(),c(!0),m(""),!s.taskDescription||!s.operatorId||!s.machineNumber){m("Пожалуйста, заполните все обязательные поля"),c(!1);return}try{await Qr({taskDescription:s.taskDescription,operatorId:Number(s.operatorId),machineNumber:s.machineNumber,shiftDate:s.shiftDate,shiftType:s.shiftType,detailName:s.detailName,customerName:s.customerName,plannedQuantity:Number(s.plannedQuantity)||0,...s.techCardId&&{techCardId:Number(s.techCardId)}}),a({taskDescription:"",operatorId:"",machineNumber:"",shiftDate:new Date().toISOString().split("T")[0],shiftType:"day",detailName:"",customerName:"",plannedQuantity:"",techCardId:""}),t==null||t()}catch{m("Ошибка при создании задания")}finally{c(!1)}},y=b=>{const{name:j,value:N}=b.target;a(x=>({...x,[j]:N}))};return e.jsxs("div",{className:"bg-white rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Создать новое задание"}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Оператор ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"operatorId",value:s.operatorId,onChange:y,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Выберите оператора"}),n.map(b=>e.jsxs("option",{value:b.id,children:[b.firstName," ",b.lastName]},b.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Номер машины ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"machineNumber",value:s.machineNumber,onChange:y,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Например: СТ-001"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Технологическая карта"}),e.jsxs("select",{name:"techCardId",value:s.techCardId,onChange:y,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Выберите технологическую карту (опционально)"}),l.map(b=>e.jsxs("option",{value:b.id,children:[b.title," v",b.version," - ",b.productName]},b.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Привязка техкарты поможет оператору следовать технологическому процессу"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Дата смены ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"shiftDate",value:s.shiftDate,onChange:y,required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Тип смены"}),e.jsxs("select",{name:"shiftType",value:s.shiftType,onChange:y,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"day",children:"Дневная"}),e.jsx("option",{value:"night",children:"Ночная"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Плановое количество"}),e.jsx("input",{type:"number",name:"plannedQuantity",value:s.plannedQuantity,onChange:y,min:"0",className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Название детали"}),e.jsx("input",{type:"text",name:"detailName",value:s.detailName,onChange:y,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Например: Втулка стальная"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Заказчик"}),e.jsx("input",{type:"text",name:"customerName",value:s.customerName,onChange:y,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Например: ООО МеталлСтрой"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Описание задачи ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"taskDescription",value:s.taskDescription,onChange:y,required:!0,rows:3,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Подробное описание задачи для оператора..."})]}),u&&e.jsx("div",{className:"text-red-600 text-sm",children:u}),e.jsx("div",{className:"flex space-x-4",children:e.jsx("button",{type:"submit",disabled:d,className:`px-4 py-2 rounded text-white font-medium ${d?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:d?"Создание...":"Создать задание"})})]})]})},Kr=({onUploadComplete:t})=>{const[s,a]=i.useState(null),[n,r]=i.useState(!1),[l,o]=i.useState(null),[d,c]=i.useState(""),u=g=>{var p;const h=(p=g.target.files)==null?void 0:p[0];if(h){const y=[".xlsx",".xls"],b=h.name.toLowerCase().slice(h.name.lastIndexOf("."));y.includes(b)?(a(h),c(""),o(null)):(c("Выберите Excel файл (.xlsx или .xls)"),g.target.value="")}},m=async()=>{if(!s){c("Выберите файл для загрузки");return}r(!0),c("");try{const g=new FormData;g.append("excelFile",s);const h=localStorage.getItem("token"),p=await fetch("http://localhost:3001/api/assignments/upload-excel",{method:"POST",headers:{Authorization:`Bearer ${h}`},body:g});if(p.ok){const y=await p.json();o(y),t(),a(null);const b=document.getElementById("excel-file");b&&(b.value="")}else{const y=await p.json().catch(()=>({message:"Ошибка сервера"}));c(y.message||`Ошибка ${p.status}`)}}catch(g){console.error("Ошибка загрузки:",g),c("Ошибка соединения с сервером")}finally{r(!1)}};return e.jsx("div",{className:"bg-white border-2 border-dashed border-gray-300 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"📊"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Массовая загрузка сменных заданий"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Загрузите Excel файл с данными о сменных заданиях для автоматического создания заданий"}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{id:"excel-file",type:"file",accept:".xlsx,.xls",onChange:u,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})}),s&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded",children:[e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Выбран файл:"})," ",s.name]}),e.jsxs("div",{className:"text-xs text-blue-600",children:["Размер: ",(s.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:m,disabled:!s||n,className:`px-6 py-2 rounded font-medium ${!s||n?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:n?"Обработка файла...":"Загрузить задания"}),d&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded",children:e.jsx("div",{className:"text-red-800 text-sm",children:d})}),l&&e.jsxs("div",{className:"mt-6 text-left",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Результаты обработки:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.summary.total}),e.jsx("div",{className:"text-xs text-blue-800",children:"Всего строк"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.summary.created}),e.jsx("div",{className:"text-xs text-green-800",children:"Создано"})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:l.summary.errors}),e.jsx("div",{className:"text-xs text-red-800",children:"Ошибки"})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 rounded text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:l.summary.skipped}),e.jsx("div",{className:"text-xs text-yellow-800",children:"Пропущено"})]})]}),l.details.success.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"font-medium text-green-800 mb-2",children:["✅ Успешно созданы (",l.details.success.length,"):"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-green-50 p-2 rounded text-xs",children:l.details.success.map((g,h)=>e.jsxs("div",{className:"text-green-700",children:["Строка ",g.row,": ",g.operator," → ",g.machine," (ID: ",g.assignmentId,")"]},h))})]}),l.details.errors.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"font-medium text-red-800 mb-2",children:["❌ Ошибки (",l.details.errors.length,"):"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-red-50 p-2 rounded text-xs",children:l.details.errors.map((g,h)=>e.jsxs("div",{className:"text-red-700",children:["Строка ",g.row,": ",g.error]},h))})]})]}),e.jsxs("div",{className:"mt-6 text-left text-xs text-gray-600",children:[e.jsx("h5",{className:"font-medium mb-2",children:"📋 Формат Excel файла:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Заказчик"})," - название компании-заказчика"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Наименование заказа"})," - номер/код заказа"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Дата смены"})," - дата в формате ГГГГ-ММ-ДД"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Тип смены"}),' - "день" или "ночь"']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Логин оператора"})," - логин существующего пользователя"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Плановое количество"})," - число деталей для обработки"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Номер станка"})," - код/номер оборудования"]})]})]})]})})},Yr=()=>{const{user:t}=R(),[s,a]=i.useState(!1),[n,r]=i.useState(!1),[l,o]=i.useState(!1),[d,c]=i.useState(0),[u,m]=i.useState(!1),g=(t==null?void 0:t.role)==="master"||(t==null?void 0:t.role)==="admin",h=(t==null?void 0:t.role)==="master"||(t==null?void 0:t.role)==="admin",p=()=>{a(!1),c(j=>j+1)},y=()=>{r(!1),c(j=>j+1)},b=async()=>{m(!0);try{const j=localStorage.getItem("token"),N=await fetch("/api/assignments/delete-all-active",{method:"DELETE",headers:{Authorization:`Bearer ${j}`,"Content-Type":"application/json"}});if(!N.ok)throw new Error("Ошибка при удалении заданий");const x=await N.json();alert(`Успешно удалено ${x.deletedCount} активных заданий`),c(f=>f+1),o(!1)}catch(j){console.error("Ошибка удаления заданий:",j),alert("Ошибка при удалении заданий")}finally{m(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-900",children:"📋 Сменные задания"}),e.jsx("p",{className:"text-blue-700 mt-1",children:h?`Управление заданиями для всех операторов (${t==null?void 0:t.role})`:`Ваши персональные задания, ${t==null?void 0:t.firstName}`})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:h?"Все задания":"Мои задания"}),g&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{a(!s),r(!1)},className:`px-4 py-2 rounded font-medium ${s?"bg-gray-500 text-white hover:bg-gray-600":"bg-green-600 text-white hover:bg-green-700"}`,children:s?"Отменить":"+ Создать задание"}),e.jsx("button",{onClick:()=>{r(!n),a(!1)},className:`px-4 py-2 rounded font-medium ${n?"bg-gray-500 text-white hover:bg-gray-600":"bg-blue-600 text-white hover:bg-blue-700"}`,children:n?"Отменить":"📊 Загрузить Excel"}),e.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 rounded font-medium bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",disabled:u,children:u?"⏳ Удаление...":"🗑️ Удалить все активные"})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold text-red-600 mb-4",children:"⚠️ Подтверждение удаления"}),e.jsxs("p",{className:"text-gray-700 mb-6",children:["Вы действительно хотите удалить ",e.jsx("strong",{children:"все активные задания"}),"?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"text-red-600 font-medium",children:"Это действие нельзя отменить!"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>o(!1),className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",disabled:u,children:"Отменить"}),e.jsx("button",{onClick:b,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",disabled:u,children:u?"Удаление...":"Удалить все"})]})]})}),s&&g&&e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded",children:e.jsx(Jr,{onAssignmentCreated:p})}),n&&g&&e.jsx("div",{className:"mb-6",children:e.jsx(Kr,{onUploadComplete:y})}),e.jsx(_r,{userRole:(t==null?void 0:t.role)||"employee"},d)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"📊 Функции"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Доступные действия"}),e.jsx("div",{className:"space-y-2 text-sm",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-green-600",children:"✅ Создание заданий"}),e.jsx("div",{className:"text-green-600",children:"✅ Массовая загрузка Excel"}),e.jsx("div",{className:"text-green-600",children:"✅ Управление всеми заданиями"}),e.jsx("div",{className:"text-red-600",children:"🗑️ Удаление всех активных заданий"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-blue-600",children:"👁️ Просмотр своих заданий"}),e.jsx("div",{className:"text-blue-600",children:"✏️ Отметка выполнения"}),e.jsx("div",{className:"text-blue-600",children:"📝 Ввод фактического количества"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"👤 Профиль"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Информация о пользователе"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Имя:"})," ",t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Роль:"})," ",t==null?void 0:t.role]}),(t==null?void 0:t.department)&&e.jsxs("div",{children:[e.jsx("strong",{children:"Отдел:"})," ",t.department.name]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"📋 Справка"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Как работать с заданиями"}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsx("div",{children:"• Задания создаются мастерами"}),e.jsx("div",{children:"• Операторы выполняют задания"}),e.jsx("div",{children:"• Можно загружать Excel файлы"}),e.jsx("div",{children:"• Отмечайте фактическое количество"}),e.jsx("div",{children:"• Активные задания можно удалить все сразу"})]})]})]})]})},Gr=()=>{const{user:t,loading:s,login:a}=R();return s?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Загрузка..."})}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{}),t&&e.jsx(Js,{}),e.jsx("main",{className:"flex-1 bg-gray-50 py-6",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs(qe,{children:[e.jsx($,{path:"/login",element:e.jsx(Gs,{onLogin:a})}),e.jsx($,{path:"/*",element:e.jsx(Br,{children:e.jsxs(qe,{children:[e.jsx($,{path:"/",element:e.jsx(Hr,{})}),e.jsx($,{path:"/admin",element:(t==null?void 0:t.role)==="admin"?e.jsx(Or,{}):e.jsx(pe,{to:"/",replace:!0})}),e.jsx($,{path:"/departments/:departmentId",element:e.jsx(Ir,{})}),e.jsx($,{path:"/documents",element:e.jsx(gr,{})}),e.jsx($,{path:"/profile",element:e.jsx(sr,{})}),e.jsx($,{path:"/production-plans",element:e.jsx(tr,{})}),e.jsx($,{path:"/assignments",element:e.jsx(Yr,{})}),e.jsx($,{path:"/techcards",element:e.jsx(kr,{})}),e.jsx($,{path:"/main",element:e.jsx(Ks,{})}),e.jsx($,{path:"*",element:e.jsx(pe,{to:"/",replace:!0})})]})})})]})})})]})},Xr=()=>e.jsx(Gr,{}),Zr=new Nt;xe.createRoot(document.getElementById("root")).render(e.jsx(kt.StrictMode,{children:e.jsx(Us,{children:e.jsxs(vt,{client:Zr,children:[" ",e.jsx(Vs,{children:e.jsx(Xr,{})})]})})}));
